<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Nuri Wallet: A Stateless MuSig2 Bitcoin Wallet with Decaying Multisig Recovery | Art & Articles by Emin Mahrt</title><meta name=keywords content="email-post"><meta name=description content="
Work in Progress. Document written by Opus 4.5
Technical Design Document

Executive Summary
Nuri Wallet is a next-generation Bitcoin wallet that combines MuSig2
Schnorr signatures, stateless key derivation via WebAuthn PRF,
NFC hardware wallet integration, and server-assisted two-factor
authentication into a unified security architecture. The design
prioritizes both security and recoverability through a decaying
multisig mechanism that ensures users can always recover their
funds, even if one or more signing components become unavailable."><meta name=author content="Emin Henri Mahrt"><link rel=canonical href=https://emino.app/posts/nuri-wallet-a-stateless-musig2-bitcoin-wallet-with-decaying/><link crossorigin=anonymous href=/assets/css/stylesheet.4372053d75d77ffd536f4c15275103ea7a53accf0bb252b18bfacc814611d64b.css integrity="sha256-Q3IFPXXXf/1Tb0wVJ1ED6npTrM8LslKxi/rMgUYR1ks=" rel="preload stylesheet" as=style><link rel=icon href=https://emino.app/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://emino.app/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://emino.app/favicon-32x32.png><link rel=apple-touch-icon href=https://emino.app/apple-touch-icon.png><link rel=mask-icon href=https://emino.app/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://emino.app/posts/nuri-wallet-a-stateless-musig2-bitcoin-wallet-with-decaying/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://emino.app/posts/nuri-wallet-a-stateless-musig2-bitcoin-wallet-with-decaying/"><meta property="og:site_name" content="Art & Articles by Emin Mahrt"><meta property="og:title" content="Nuri Wallet: A Stateless MuSig2 Bitcoin Wallet with Decaying Multisig Recovery"><meta property="og:description" content="
Work in Progress. Document written by Opus 4.5
Technical Design Document Executive Summary Nuri Wallet is a next-generation Bitcoin wallet that combines MuSig2 Schnorr signatures, stateless key derivation via WebAuthn PRF, NFC hardware wallet integration, and server-assisted two-factor authentication into a unified security architecture. The design prioritizes both security and recoverability through a decaying multisig mechanism that ensures users can always recover their funds, even if one or more signing components become unavailable."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-12-08T21:00:01+00:00"><meta property="article:modified_time" content="2025-12-08T21:00:01+00:00"><meta property="article:tag" content="Email-Post"><meta name=twitter:card content="summary"><meta name=twitter:title content="Nuri Wallet: A Stateless MuSig2 Bitcoin Wallet with Decaying Multisig Recovery"><meta name=twitter:description content="
Work in Progress. Document written by Opus 4.5
Technical Design Document

Executive Summary
Nuri Wallet is a next-generation Bitcoin wallet that combines MuSig2
Schnorr signatures, stateless key derivation via WebAuthn PRF,
NFC hardware wallet integration, and server-assisted two-factor
authentication into a unified security architecture. The design
prioritizes both security and recoverability through a decaying
multisig mechanism that ensures users can always recover their
funds, even if one or more signing components become unavailable."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://emino.app/posts/"},{"@type":"ListItem","position":2,"name":"Nuri Wallet: A Stateless MuSig2 Bitcoin Wallet with Decaying Multisig Recovery","item":"https://emino.app/posts/nuri-wallet-a-stateless-musig2-bitcoin-wallet-with-decaying/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Nuri Wallet: A Stateless MuSig2 Bitcoin Wallet with Decaying Multisig Recovery","name":"Nuri Wallet: A Stateless MuSig2 Bitcoin Wallet with Decaying Multisig Recovery","description":"\nWork in Progress. Document written by Opus 4.5\nTechnical Design Document Executive Summary Nuri Wallet is a next-generation Bitcoin wallet that combines MuSig2 Schnorr signatures, stateless key derivation via WebAuthn PRF, NFC hardware wallet integration, and server-assisted two-factor authentication into a unified security architecture. The design prioritizes both security and recoverability through a decaying multisig mechanism that ensures users can always recover their funds, even if one or more signing components become unavailable.\n","keywords":["email-post"],"articleBody":"\nWork in Progress. Document written by Opus 4.5\nTechnical Design Document Executive Summary Nuri Wallet is a next-generation Bitcoin wallet that combines MuSig2 Schnorr signatures, stateless key derivation via WebAuthn PRF, NFC hardware wallet integration, and server-assisted two-factor authentication into a unified security architecture. The design prioritizes both security and recoverability through a decaying multisig mechanism that ensures users can always recover their funds, even if one or more signing components become unavailable.\nTable of Contents Introduction Architecture Overview Key Components Stateless Passkey Wallet Hardware Wallet (NFC SatochipSigning Device) Stateless Server MuSig2 Protocol Integration Wallet Configurations 2-of-2 Configuration 2-of-3 Configuration Decaying Multisig with CSV Timelocks Security Analysis Recovery Scenarios Comparison with Existing Solutions Implementation Considerations Introduction Traditional Bitcoin wallets face a fundamental tension between security and usability. Single-signature wallets are vulnerable to key theft, while multisig wallets can lock users out of their funds if keys are lost. Nuri Wallet resolves this tension through an innovative combination of:\nStateless key derivation: No persistent key storage means no keys to steal from rest MuSig2 aggregated signatures: Multiple parties contribute to a single Schnorr signature, maintaining privacy and reducing transaction fees Decaying timelocks: Graduated recovery options that balance security against lockout risk Hardware wallet integration: Optional cold storage for maximum security Architecture Overview â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ NURI WALLET ARCHITECTURE â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ PASSKEY KEY â”‚ â”‚ HARDWARE KEY â”‚ â”‚ SERVER KEY â”‚ â”‚ â”‚ â”‚ (Stateless) â”‚ â”‚ (NFC Satochip) â”‚ â”‚ (Stateless) â”‚ â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ WebAuthn PRF â”‚ â”‚ Secure Element â”‚ â”‚ HSM/Secure â”‚ â”‚ â”‚ â”‚ Extension â”‚ â”‚ on NFC Card â”‚ â”‚ Element â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ key = PRF(salt) â”‚ â”‚ Private key â”‚ â”‚ key = f(user_id, â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ never leaves â”‚ â”‚ entropy) â”‚ â”‚ â”‚ â”‚ No key storage â”‚ â”‚ the chip â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ MuSig2 Partial â”‚ MuSig2 Partial â”‚ â”‚ â”‚ â”‚ Signature â”‚ Signature â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â–¼ â–¼ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ MuSig2 SIGNATURE AGGREGATION â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ 2-of-2: Passkey + Server â”‚ â”‚ â”‚ â”‚ 2-of-3: Any 2 of {Passkey, HW, Server} â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ DECAYING TIMELOCK STRUCTURE â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ T=0 T=10,000 blocks T=52,560 â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ blocks â”‚ â”‚ â”‚ â”‚ â–¼ â–¼ â–¼ â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ â”‚ â”‚ NORMAL OPERATION â”‚ RECOVERY MODE â”‚ EMERGENCY EXIT â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ 2-of-2 or 2-of-3 â”‚ Passkey + HW â”‚ Passkey only â”‚ â”‚ â”‚ â”‚ â”‚ (Server active) â”‚ (Server unavailable) â”‚ (CSV expired) â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Key Components Stateless Passkey Wallet The passkey-based key is the cornerstone of Nuriâ€™s user experience. It leverages the WebAuthn PRF (Pseudo-Random Function) extension to derive cryptographic keys without ever storing them.\nHow It Works â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ PASSKEY KEY DERIVATION â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ User authenticates with passkey (biometric/PIN) â”‚ â”‚ â”‚ â”‚ â”‚ â–¼ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ WebAuthn Authenticator â”‚ â”‚ â”‚ â”‚ (Platform or Roaming Authenticator) â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”‚ â–¼ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ PRF Extension â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ secret = HMAC-SHA256(device_secret, â”‚ â”‚ â”‚ â”‚ salt || rpId) â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”‚ â–¼ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Bitcoin Key Derivation â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ private_key = HKDF(secret, â”‚ â”‚ â”‚ â”‚ \"nuri-bitcoin\", â”‚ â”‚ â”‚ â”‚ derivation_path) â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Security Properties Property Description Stateless No private keys stored on device; derived on-demand Phishing Resistant WebAuthn binds credentials to origin Hardware-Backed PRF secret stored in device secure element Biometric Protected User presence verified via fingerprint/face Key Derivation Formula Given:\n$s$ = device master secret (in secure element) $\\text{salt}$ = application-specific salt $\\text{rpId}$ = relying party identifier The PRF output is:\n$$\\text{prf_output} = \\text{HMAC-SHA256}(s, \\text{salt} | \\text{rpId})$$\nThe Bitcoin private key is then derived as:\n$$k_{\\text{passkey}} = \\text{HKDF-SHA256}(\\text{prf_output}, \\text{â€œnuri-btc-v1â€}, \\text{path})$$\nHardware Wallet (NFC Satochip Signing Device) The hardware wallet component uses an NFC-based secure element card (similar to Satochip or SatSigner) that performs MuSig2 partial signing without ever exposing its private key.\nCapabilities â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ NFC HARDWARE WALLET â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Secure Element â”‚ â”‚ â”‚ â”‚ (JavaCard/etc) â”‚ â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ â€¢ Private key â”‚ â—„â”€â”€ Never leaves the chip â”‚ â”‚ â”‚ generation â”‚ â”‚ â”‚ â”‚ â€¢ MuSig2 nonce â”‚ â”‚ â”‚ â”‚ generation â”‚ â”‚ â”‚ â”‚ â€¢ Partial signature â”‚ â”‚ â”‚ â”‚ creation â”‚ â”‚ â”‚ â”‚ â€¢ Public key export â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â–² â”‚ â”‚ â”‚ NFC â”‚ â”‚ â–¼ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Mobile Device â”‚ â”‚ â”‚ â”‚ (Nuri App) â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ MuSig2 Signing Flow Nonce Commitment Round: Card generates random nonce $R_{\\text{hw}}$ and provides commitment Nonce Exchange: All parties exchange nonce commitments, then reveal nonces Partial Signing: Card computes partial signature without revealing private key Aggregation: Partial signatures combined into final Schnorr signature Stateless Server The server acts as a 2FA-protected co-signer that adds entropy and provides an additional security layer without introducing custody risk.\nDesign Principles â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ STATELESS SERVER â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Hardware Security Module â”‚ â”‚ â”‚ â”‚ (HSM) â”‚ â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ â€¢ Master seed (never exported) â”‚ â”‚ â”‚ â”‚ â€¢ Deterministic key derivation â”‚ â”‚ â”‚ â”‚ â€¢ Rate limiting â”‚ â”‚ â”‚ â”‚ â€¢ Audit logging â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”‚ â–¼ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Key Derivation Function â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ k_server = KDF(master_seed, â”‚ â”‚ â”‚ â”‚ user_id, â”‚ â”‚ â”‚ â”‚ wallet_id, â”‚ â”‚ â”‚ â”‚ key_index) â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ Properties: â”‚ â”‚ â€¢ No private keys stored in database â”‚ â”‚ â€¢ Keys derived on-demand from HSM â”‚ â”‚ â€¢ 2FA required before signing â”‚ â”‚ â€¢ Server breach doesn't compromise keys â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Server Key Derivation The server derives user-specific keys deterministically:\n$$k_{\\text{server}} = \\text{HKDF}(k_{\\text{master}}, \\text{user_id} | \\text{wallet_id} | \\text{index})$$\nWhere $k_{\\text{master}}$ is stored in the HSM and never exported.\nMuSig2 Protocol Integration MuSig2 is a multi-signature scheme that produces a single aggregated Schnorr signature indistinguishable from a regular signature. This provides both privacy (observers canâ€™t tell itâ€™s multisig) and efficiency (smaller transactions, lower fees).\nMuSig2 Overview â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ MuSig2 PROTOCOL â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ SETUP PHASE (one-time) â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”‚ â”‚ Each party i has: â”‚ â”‚ â€¢ Private key: xáµ¢ â”‚ â”‚ â€¢ Public key: Páµ¢ = xáµ¢ Â· G â”‚ â”‚ â”‚ â”‚ Aggregated public key: â”‚ â”‚ P = Î£áµ¢ (aáµ¢ Â· Páµ¢) â”‚ â”‚ where aáµ¢ = H(L, Páµ¢) and L = {Pâ‚, Pâ‚‚, ...} â”‚ â”‚ â”‚ â”‚ SIGNING PHASE (per transaction) â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”‚ â”‚ Round 1: Nonce Generation â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Party 1 â”‚ â”‚ Party 2 â”‚ â”‚ Party 3 â”‚ â”‚ â”‚ â”‚ râ‚ â†’ Râ‚ â”‚ â”‚ râ‚‚ â†’ Râ‚‚ â”‚ â”‚ râ‚ƒ â†’ Râ‚ƒ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â–¼ â”‚ â”‚ Exchange Ráµ¢ values â”‚ â”‚ â”‚ â”‚ â”‚ â–¼ â”‚ â”‚ Round 2: Partial Signatures â”‚ â”‚ â”‚ â”‚ R = Î£áµ¢ Ráµ¢ (aggregated nonce) â”‚ â”‚ c = H(R, P, m) (challenge) â”‚ â”‚ â”‚ â”‚ Each party computes: â”‚ â”‚ sáµ¢ = ráµ¢ + c Â· aáµ¢ Â· xáµ¢ â”‚ â”‚ â”‚ â”‚ Final signature: â”‚ â”‚ s = Î£áµ¢ sáµ¢ â”‚ â”‚ Ïƒ = (R, s) â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Why MuSig2 for Nuri? Benefit Description Privacy Aggregated signature looks like single-sig on-chain Efficiency One signature regardless of number of signers Taproot Native Designed for Bitcoinâ€™s Schnorr/Taproot upgrade Non-Interactive Only 2 rounds of communication needed Wallet Configurations 2-of-2 Configuration The basic configuration requires both the passkey and server to sign transactions.\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ 2-of-2 CONFIGURATION â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ NORMAL OPERATION â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Passkey â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Server â”‚ â”‚ â”‚ â”‚ Key â”‚ 2FA â”‚ Key â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ verify â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ MuSig2 â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â–¼ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Combined â”‚ â”‚ â”‚ â”‚Signature â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ RECOVERY (Server Unavailable) â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”‚ â”‚ After CSV timelock expires (~1 year): â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Passkey â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Spend with single signature â”‚ â”‚ â”‚ Key â”‚ (CSV exit path) â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Transaction Structure (Taproot) Output Script (P2TR): â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ OP_1 â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Taproot Tree: â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Internal Key â”‚ â”‚ (MuSig2: Passkey + Server) â”‚ â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Leaf 1 â”‚ â”‚ Leaf 2 â”‚ â”‚ â”‚ â”‚ (empty) â”‚ â”‚ CSV Exit â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ CHECKSIG â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ \u003c52560\u003e â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ CSV â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ 2-of-3 Configuration The enhanced configuration adds a hardware wallet for additional security and recovery options.\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ 2-of-3 CONFIGURATION â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ THREE SIGNING KEYS â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Passkey â”‚ â”‚ Hardware â”‚ â”‚ Server â”‚ â”‚ â”‚ â”‚ (Hot) â”‚ â”‚ Wallet â”‚ â”‚ (2FA) â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ (Cold) â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â–¼ â–¼ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ ANY 2-of-3 can sign â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â€¢ Passkey + Server (daily) â”‚ â”‚ â”‚ â”‚ â€¢ Passkey + HW (recovery) â”‚ â”‚ â”‚ â”‚ â€¢ Server + HW (if needed) â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ SIGNING SCENARIOS â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”‚ â”‚ Scenario 1: Normal (Passkey + Server) â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” 2FA â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Passkey â”œâ”€â”€â”€â”€â”€â”€â–¶â”‚ Server â”‚â”€â”€â”€â”€â–¶ âœ“ Transaction â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ Scenario 2: Server Down (Passkey + Hardware) â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” NFC â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Passkey â”œâ”€â”€â”€â”€â”€â”€â–¶â”‚ HW â”‚â”€â”€â”€â”€â–¶ âœ“ Transaction â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ (No waiting!) â”‚ â”‚ â”‚ â”‚ Scenario 3: Passkey Lost (Hardware + Server) â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ HW â”œâ”€â”€â”€â”€â”€â”€â–¶â”‚ Server â”‚â”€â”€â”€â”€â–¶ âœ“ Transaction â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Taproot Structure for 2-of-3 Taproot Tree (2-of-3): â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Internal Key â”‚ â”‚ (MuSig2: Passkey + Server - default path) â”‚ â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Leaf 1 â”‚ â”‚ Leaf 2 â”‚ â”‚ Leaf 3 â”‚ â”‚ â”‚ â”‚Passkey+ â”‚ â”‚ Passkey+ â”‚ â”‚ CSV Exit â”‚ â”‚ â”‚ â”‚ HW â”‚ â”‚ Server â”‚ â”‚ â”‚ â”‚ â”‚ â”‚(MuSig2) â”‚ â”‚ (redundant) â”‚ â”‚ CHECKSIG â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ \u003c52560\u003e CSV â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ Note: Server+HW combination handled via Leaf 2 alternative â”‚ â”‚ or additional leaf as needed â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Decaying Multisig with CSV Timelocks The decaying multisig pattern ensures that users can always recover their funds, with security guarantees that gracefully degrade over time.\nHow CSV (CheckSequenceVerify) Works CSV enforces a relative timelock measured in blocks since the UTXO was created:\n$$\\text{spendable_height} = \\text{confirmation_height} + \\text{csv_blocks}$$\nFor Nuri Wallet:\nNormal operation: 2-of-2 or 2-of-3 MuSig2 required After ~70 days (10,000 blocks): Alternative recovery paths activate After ~1 year (52,560 blocks): Single-key emergency exit available Timelock Visualization â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ DECAYING SECURITY MODEL â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ Security â”‚ â”‚ Level â”‚ â”‚ â–² â”‚ â”‚ â”‚ â”‚ â”‚ 3 â”¤ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ” â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ 2 â”¤ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 2-of-3 config â”‚ â”‚ â”‚ â”‚ (HW available) â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ 1 â”¤ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚ â”‚ T=0 T=10,000 T=52,560 Time â”‚ â”‚ â”‚ blocks blocks (blocks) â”‚ â”‚ â”‚ (~70 days) (~1 year) â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â–¼ â–¼ â–¼ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Maximum â”‚ â”‚ HW Recovery â”‚ â”‚ Emergency â”‚ â”‚ â”‚ â”‚ Security â”‚ â”‚ Available â”‚ â”‚ Exit â”‚ â”‚ â”‚ â”‚ 2FA + â”‚ â”‚ No server â”‚ â”‚ Passkey â”‚ â”‚ â”‚ â”‚ Passkey â”‚ â”‚ needed â”‚ â”‚ only â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Script Structure CSV Exit Script (simplified):\nOP_IF // Normal spending path: requires aggregated MuSig2 signature OP_CHECKSIG OP_ELSE // Emergency exit: after timelock, passkey alone can spend \u003c52560\u003e // ~1 year in blocks OP_CHECKSEQUENCEVERIFY OP_DROP OP_CHECKSIG OP_ENDIF Re-locking Mechanism To maintain maximum security, users should periodically â€œrefreshâ€ their UTXOs:\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ UTXO REFRESH CYCLE â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ Initial Deposit After 11 months Re-deposit â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â–¼ â–¼ â–¼ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ UTXO â”‚ Time â”‚ UTXO â”‚ Self- â”‚ UTXO â”‚ â”‚ â”‚ â”‚ CSV=0 â”‚ â”€â”€â”€â”€â”€â–¶ â”‚CSV=47520â”‚ send â”‚ CSV=0 â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ (aging) â”‚ â”€â”€â”€â”€â”€â–¶ â”‚ (fresh) â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ Security: MAX Security: Degrading Security: MAXâ”‚ â”‚ â”‚ â”‚ Wallet prompts user when UTXOs approach timelock expiry â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Security Analysis Threat Model Threat Mitigation Device theft Passkey protected by biometrics; key derived on-demand Server compromise Server keys in HSM; stateless derivation; server alone cannot spend Phishing WebAuthn origin binding prevents credential theft Man-in-the-middle MuSig2 nonce protocol prevents signature forgery Server disappearance CSV timelock enables recovery; HW wallet provides immediate alternative Hardware wallet loss 2-of-3 allows recovery with passkey + server Passkey loss 2-of-3 allows recovery with HW + server Security Levels by Configuration â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ SECURITY COMPARISON â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ 2-of-2 2-of-3 â”‚ â”‚ â”€â”€â”€â”€â”€â”€ â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”‚ â”‚ Keys Required 2 2 â”‚ â”‚ to Spend â”‚ â”‚ â”‚ â”‚ Single Point Passkey None â”‚ â”‚ of Failure (for CSV exit) (any 2 keys work) â”‚ â”‚ â”‚ â”‚ Server Down Wait ~1 year Use Passkey + HW â”‚ â”‚ Recovery (immediate) â”‚ â”‚ â”‚ â”‚ Passkey Lost Funds locked Use Server + HW â”‚ â”‚ Recovery (CSV doesn't (immediate) â”‚ â”‚ help here!) â”‚ â”‚ â”‚ â”‚ Best For Simplicity, Maximum security, â”‚ â”‚ casual users significant holdings â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Attack Scenarios Scenario 1: Attacker Compromises Server Attacker obtains: Server signing capability Attacker needs: Passkey authentication OR Hardware wallet Result: âŒ Cannot steal funds (missing second key) âš ï¸ Can potentially DoS by refusing to sign âœ… User recovers via CSV exit or HW wallet Scenario 2: Attacker Steals Phone Attacker obtains: Physical device Attacker needs: Biometric/PIN to unlock passkey PLUS 2FA to authorize server signing Result: âŒ Cannot steal funds (passkey protected by biometrics) âœ… Keys never stored on device (stateless) Scenario 3: Attacker Compromises Both Passkey AND Server Attacker obtains: Passkey credential + Server access Result: âš ï¸ Can steal funds in 2-of-2 config âœ… 2-of-3 config: HW wallet still required Recovery Scenarios Complete Recovery Matrix Scenario 2-of-2 Config 2-of-3 Config Lost phone (passkey) Wait for CSV (~1 year), thenâ€¦ âŒ still canâ€™t spend! Server + HW âœ… Server goes offline Wait for CSV (~1 year) âœ… Passkey + HW âœ… (immediate) Lost hardware wallet N/A (not in config) Passkey + Server âœ… Lost phone + server down âŒ Funds lost HW can spend after CSV? (design decision) Lost HW + server down Wait for CSV âœ… Wait for CSV âœ… Recovery Flow: Server Unavailable (2-of-3) â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ RECOVERY: SERVER UNAVAILABLE (2-of-3) â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ Step 1: Detect server unavailability â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ App: \"Server unreachable. Use hardware â”‚ â”‚ â”‚ â”‚ wallet for recovery signing?\" â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ Step 2: Authenticate with passkey â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ User: [Biometric authentication] â”‚ â”‚ â”‚ â”‚ App: Derives passkey private key â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ Step 3: Tap NFC hardware wallet â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ App: \"Tap your Nuri Card to sign\" â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ â”‚ â”‚ ğŸ“± â†â†’ ğŸ’³ â”‚ NFC â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ Step 4: MuSig2 signing between Passkey + HW â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Passkey partial sig + HW partial sig â”‚ â”‚ â”‚ â”‚ â†“ â”‚ â”‚ â”‚ â”‚ Aggregated Schnorr signature â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ Step 5: Broadcast transaction â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Transaction broadcast to Bitcoin networkâ”‚ â”‚ â”‚ â”‚ âœ… Funds recovered without server â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Recovery Flow: CSV Emergency Exit (2-of-2) â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ RECOVERY: CSV EMERGENCY EXIT â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ Prerequisites: â”‚ â”‚ â€¢ Server has been unavailable for extended period â”‚ â”‚ â€¢ UTXO age \u003e 52,560 blocks (~1 year) â”‚ â”‚ â€¢ User still has passkey access â”‚ â”‚ â”‚ â”‚ Step 1: Check UTXO eligibility â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ App scans UTXOs for CSV-eligible funds â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ UTXO 1: 0.5 BTC - Age: 55,000 blocks âœ…â”‚ â”‚ â”‚ â”‚ UTXO 2: 0.3 BTC - Age: 40,000 blocks âŒâ”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ Step 2: Construct CSV spending transaction â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Input: UTXO with nSequence = 52,560 â”‚ â”‚ â”‚ â”‚ Witness: â”‚ â”‚ â”‚ â”‚ Output: New address controlled by user â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ Step 3: Sign with passkey only â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ No server needed - single signature â”‚ â”‚ â”‚ â”‚ sufficient for CSV exit path â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ Step 4: Broadcast and confirm â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Transaction valid because: â”‚ â”‚ â”‚ â”‚ â€¢ CSV timelock satisfied â”‚ â”‚ â”‚ â”‚ â€¢ Valid passkey signature provided â”‚ â”‚ â”‚ â”‚ âœ… Funds recovered! â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Comparison with Existing Solutions Nuri vs. Blockstream Green Feature Blockstream Green Nuri Wallet Signature Scheme ECDSA multisig MuSig2 Schnorr On-chain Footprint Visible multisig Single-sig appearance Client Key Storage Encrypted on device Stateless (PRF-derived) Server Key Storage Traditional HSM Stateless HSM derivation Recovery (2-of-2) CSV timelock CSV timelock Recovery (2-of-3) Backup key phrase Hardware wallet Taproot Support Limited Native Nuri vs. Traditional Hardware Wallets Feature Ledger/Trezor Nuri Wallet Form Factor Dedicated device Passkey + NFC card Daily Transactions Device required Passkey only (server 2FA) High-Value Transactions Same as daily Can require HW card Loss Recovery Seed phrase Multiple paths (CSV, 2-of-3) Theft Risk Seed phrase exposure No seed phrase needed Nuri vs. Custodial Solutions Feature Custodial Exchange Nuri Wallet Key Control Exchange holds keys User holds all keys Counterparty Risk High None Regulatory Risk Subject to seizure Self-sovereign Recovery Account recovery CSV + multisig Privacy KYC required No KYC for self-custody Implementation Considerations WebAuthn PRF Browser Support â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ WEBAUTHN PRF SUPPORT STATUS â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ Browser/Platform PRF Support Notes â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”€â”€â”€â”€â”€ â”‚ â”‚ Chrome (Desktop) âœ… Yes Windows Hello, etc. â”‚ â”‚ Chrome (Android) âœ… Yes Fingerprint/PIN â”‚ â”‚ Safari (macOS) âœ… Yes Touch ID â”‚ â”‚ Safari (iOS) âœ… Yes Face ID/Touch ID â”‚ â”‚ Firefox âš ï¸ Partial Platform dependent â”‚ â”‚ Security Keys âš ï¸ Varies FIDO2 Level 2 req. â”‚ â”‚ â”‚ â”‚ Fallback Strategy: â”‚ â”‚ â€¢ Detect PRF support at registration â”‚ â”‚ â€¢ Fall back to encrypted key storage if unavailable â”‚ â”‚ â€¢ Clearly communicate security implications to user â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ MuSig2 Implementation Notes Key Aggregation:\n// Simplified MuSig2 key aggregation function aggregateKeys(pubkeys: Uint8Array[]): Uint8Array { // Sort pubkeys lexicographically for determinism const sortedKeys = [...pubkeys].sort(compareBytes); // Compute key aggregation coefficients const L = hashKeys(sortedKeys); // Aggregate with coefficients let aggregated = Point.ZERO; for (const pk of sortedKeys) { const P = Point.fromBytes(pk); const a = computeCoefficient(L, pk); aggregated = aggregated.add(P.multiply(a)); } return aggregated.toBytes(); } Nonce Generation (Critical for Security):\n// MuSig2 requires fresh, unpredictable nonces function generateNonce( secretKey: Uint8Array, publicKey: Uint8Array, message: Uint8Array, extraRand: Uint8Array ): { secretNonce: Uint8Array; publicNonce: Uint8Array } { // MUST use fresh randomness for each signing session const rand = crypto.getRandomValues(new Uint8Array(32)); // Derive nonce deterministically from inputs + randomness const k = taggedHash( \"MuSig2/nonce\", concat(secretKey, publicKey, message, rand, extraRand) ); return { secretNonce: k, publicNonce: Point.BASE.multiply(k).toBytes() }; } NFC Hardware Wallet Protocol â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ NFC SIGNING PROTOCOL (APDU) â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ Command Response â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”‚ â”‚ SELECT APPLET OK + Version â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ CLA: 00 â”‚ â”€â”€â–¶ â”‚ SW: 9000 â”‚ â”‚ â”‚ â”‚ INS: A4 â”‚ â”‚ Version: 1.0 â”‚ â”‚ â”‚ â”‚ AID: Nuri... â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ GET PUBLIC KEY Public Key â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ CLA: E0 â”‚ â”€â”€â–¶ â”‚ SW: 9000 â”‚ â”‚ â”‚ â”‚ INS: 40 â”‚ â”‚ PubKey: 33B â”‚ â”‚ â”‚ â”‚ Path: m/86'/...â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ MUSIG2 NONCE Nonce Commitment â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ CLA: E0 â”‚ â”€â”€â–¶ â”‚ SW: 9000 â”‚ â”‚ â”‚ â”‚ INS: 50 â”‚ â”‚ R: 33B â”‚ â”‚ â”‚ â”‚ SessionID â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ MUSIG2 SIGN Partial Signature â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ CLA: E0 â”‚ â”€â”€â–¶ â”‚ SW: 9000 â”‚ â”‚ â”‚ â”‚ INS: 52 â”‚ â”‚ s: 32B â”‚ â”‚ â”‚ â”‚ Message hash â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ Agg nonce â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ Agg pubkey â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Conclusion Nuri Wallet represents a significant advancement in Bitcoin self-custody, combining:\nStateless Security: No persistent key storage reduces attack surface Multi-Party Signing: MuSig2 provides privacy and efficiency Graceful Degradation: Decaying timelocks ensure recovery is always possible Flexible Security: 2-of-2 and 2-of-3 configurations for different needs The architecture ensures that users maintain full sovereignty over their Bitcoin while benefiting from the security of multi-signature protection and the convenience of modern authentication methods.\nAppendix A: Glossary Term Definition CSV CheckSequenceVerify; Bitcoin opcode for relative timelocks HSM Hardware Security Module; tamper-resistant key storage MuSig2 Multi-signature scheme for Schnorr signatures PRF Pseudo-Random Function; WebAuthn extension for key derivation Taproot Bitcoin upgrade enabling Schnorr signatures and MAST UTXO Unspent Transaction Output; Bitcoinâ€™s accounting model WebAuthn Web Authentication standard for passwordless auth Appendix B: References BIP-340: Schnorr Signatures for secp256k1 BIP-341: Taproot BIP-327: MuSig2 WebAuthn PRF Extension Blockstream Green Security Model Post created via email from emin@nuri.com\n","wordCount":"3923","inLanguage":"en","datePublished":"2025-12-08T21:00:01Z","dateModified":"2025-12-08T21:00:01Z","author":{"@type":"Person","name":"Emin Henri Mahrt"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://emino.app/posts/nuri-wallet-a-stateless-musig2-bitcoin-wallet-with-decaying/"},"publisher":{"@type":"Organization","name":"Art \u0026 Articles by Emin Mahrt","logo":{"@type":"ImageObject","url":"https://emino.app/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://emino.app/ accesskey=h title="Art & Articles by Emin Mahrt (Alt + H)">Art & Articles by Emin Mahrt</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://emino.app/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://emino.app/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://emino.app/archives/ title=Archives><span>Archives</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://emino.app/>Home</a>&nbsp;Â»&nbsp;<a href=https://emino.app/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Nuri Wallet: A Stateless MuSig2 Bitcoin Wallet with Decaying Multisig Recovery</h1><div class=post-meta><span title='2025-12-08 21:00:01 +0000 UTC'>December 8, 2025</span>&nbsp;Â·&nbsp;19 min&nbsp;Â·&nbsp;Emin Henri Mahrt</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#technical-design-document aria-label="Technical Design Document">Technical Design Document</a></li><li><a href=#executive-summary aria-label="Executive Summary">Executive Summary</a></li><li><a href=#table-of-contents aria-label="Table of Contents">Table of Contents</a></li><li><a href=#introduction aria-label=Introduction>Introduction</a></li><li><a href=#architecture-overview aria-label="Architecture Overview">Architecture Overview</a></li><li><a href=#key-components aria-label="Key Components">Key Components</a><ul><li><a href=#stateless-passkey-wallet aria-label="Stateless Passkey Wallet">Stateless Passkey Wallet</a><ul><li><a href=#how-it-works aria-label="How It Works">How It Works</a></li><li><a href=#security-properties aria-label="Security Properties">Security Properties</a></li><li><a href=#key-derivation-formula aria-label="Key Derivation Formula">Key Derivation Formula</a></li></ul></li><li><a href=#hardware-wallet-nfc-satochip-signing-device aria-label="Hardware Wallet (NFC Satochip Signing Device)">Hardware Wallet (NFC Satochip Signing Device)</a><ul><li><a href=#capabilities aria-label=Capabilities>Capabilities</a></li><li><a href=#musig2-signing-flow aria-label="MuSig2 Signing Flow">MuSig2 Signing Flow</a></li></ul></li><li><a href=#stateless-server aria-label="Stateless Server">Stateless Server</a><ul><li><a href=#design-principles aria-label="Design Principles">Design Principles</a></li><li><a href=#server-key-derivation aria-label="Server Key Derivation">Server Key Derivation</a></li></ul></li></ul></li><li><a href=#musig2-protocol-integration aria-label="MuSig2 Protocol Integration">MuSig2 Protocol Integration</a><ul><li><a href=#musig2-overview aria-label="MuSig2 Overview">MuSig2 Overview</a></li><li><a href=#why-musig2-for-nuri aria-label="Why MuSig2 for Nuri?">Why MuSig2 for Nuri?</a></li></ul></li><li><a href=#wallet-configurations aria-label="Wallet Configurations">Wallet Configurations</a><ul><li><a href=#2-of-2-configuration aria-label="2-of-2 Configuration">2-of-2 Configuration</a><ul><li><a href=#transaction-structure-taproot aria-label="Transaction Structure (Taproot)">Transaction Structure (Taproot)</a></li></ul></li><li><a href=#2-of-3-configuration aria-label="2-of-3 Configuration">2-of-3 Configuration</a><ul><li><a href=#taproot-structure-for-2-of-3 aria-label="Taproot Structure for 2-of-3">Taproot Structure for 2-of-3</a></li></ul></li></ul></li><li><a href=#decaying-multisig-with-csv-timelocks aria-label="Decaying Multisig with CSV Timelocks">Decaying Multisig with CSV Timelocks</a><ul><li><a href=#how-csv-checksequenceverify-works aria-label="How CSV (CheckSequenceVerify) Works">How CSV (CheckSequenceVerify) Works</a></li><li><a href=#timelock-visualization aria-label="Timelock Visualization">Timelock Visualization</a></li><li><a href=#script-structure aria-label="Script Structure">Script Structure</a></li><li><a href=#re-locking-mechanism aria-label="Re-locking Mechanism">Re-locking Mechanism</a></li></ul></li><li><a href=#security-analysis aria-label="Security Analysis">Security Analysis</a><ul><li><a href=#threat-model aria-label="Threat Model">Threat Model</a></li><li><a href=#security-levels-by-configuration aria-label="Security Levels by Configuration">Security Levels by Configuration</a></li><li><a href=#attack-scenarios aria-label="Attack Scenarios">Attack Scenarios</a><ul><li><a href=#scenario-1-attacker-compromises-server aria-label="Scenario 1: Attacker Compromises Server">Scenario 1: Attacker Compromises Server</a></li><li><a href=#scenario-2-attacker-steals-phone aria-label="Scenario 2: Attacker Steals Phone">Scenario 2: Attacker Steals Phone</a></li><li><a href=#scenario-3-attacker-compromises-both-passkey-and-server aria-label="Scenario 3: Attacker Compromises Both Passkey AND Server">Scenario 3: Attacker Compromises Both Passkey AND Server</a></li></ul></li></ul></li><li><a href=#recovery-scenarios aria-label="Recovery Scenarios">Recovery Scenarios</a><ul><li><a href=#complete-recovery-matrix aria-label="Complete Recovery Matrix">Complete Recovery Matrix</a></li><li><a href=#recovery-flow-server-unavailable-2-of-3 aria-label="Recovery Flow: Server Unavailable (2-of-3)">Recovery Flow: Server Unavailable (2-of-3)</a></li><li><a href=#recovery-flow-csv-emergency-exit-2-of-2 aria-label="Recovery Flow: CSV Emergency Exit (2-of-2)">Recovery Flow: CSV Emergency Exit (2-of-2)</a></li></ul></li><li><a href=#comparison-with-existing-solutions aria-label="Comparison with Existing Solutions">Comparison with Existing Solutions</a><ul><li><a href=#nuri-vs-blockstream-green aria-label="Nuri vs. Blockstream Green">Nuri vs. Blockstream Green</a></li><li><a href=#nuri-vs-traditional-hardware-wallets aria-label="Nuri vs. Traditional Hardware Wallets">Nuri vs. Traditional Hardware Wallets</a></li><li><a href=#nuri-vs-custodial-solutions aria-label="Nuri vs. Custodial Solutions">Nuri vs. Custodial Solutions</a></li></ul></li><li><a href=#implementation-considerations aria-label="Implementation Considerations">Implementation Considerations</a><ul><li><a href=#webauthn-prf-browser-support aria-label="WebAuthn PRF Browser Support">WebAuthn PRF Browser Support</a></li><li><a href=#musig2-implementation-notes aria-label="MuSig2 Implementation Notes">MuSig2 Implementation Notes</a></li><li><a href=#nfc-hardware-wallet-protocol aria-label="NFC Hardware Wallet Protocol">NFC Hardware Wallet Protocol</a></li></ul></li><li><a href=#conclusion aria-label=Conclusion>Conclusion</a></li><li><a href=#appendix-a-glossary aria-label="Appendix A: Glossary">Appendix A: Glossary</a></li><li><a href=#appendix-b-references aria-label="Appendix B: References">Appendix B: References</a></li></ul></div></details></div><div class=post-content><p><img loading=lazy src=/media/nuri-wallet-a-stateless-musig2-bitcoin-wallet-with-decaying-/cover.jpg></p><p>Work in Progress. Document written by Opus 4.5</p><h2 id=technical-design-document>Technical Design Document<a hidden class=anchor aria-hidden=true href=#technical-design-document>#</a></h2><hr><h2 id=executive-summary>Executive Summary<a hidden class=anchor aria-hidden=true href=#executive-summary>#</a></h2><p>Nuri Wallet is a next-generation Bitcoin wallet that combines <strong>MuSig2
Schnorr signatures</strong>, <strong>stateless key derivation via WebAuthn PRF</strong>,
<strong>NFC hardware wallet integration</strong>, and <strong>server-assisted two-factor
authentication</strong> into a unified security architecture. The design
prioritizes both security and recoverability through a <strong>decaying
multisig</strong> mechanism that ensures users can always recover their
funds, even if one or more signing components become unavailable.</p><hr><h2 id=table-of-contents>Table of Contents<a hidden class=anchor aria-hidden=true href=#table-of-contents>#</a></h2><ol><li><a href=#introduction>Introduction</a></li><li><a href=#architecture-overview>Architecture Overview</a></li><li><a href=#key-components>Key Components</a><ul><li><a href=#stateless-passkey-wallet>Stateless Passkey Wallet</a></li><li><a href=#hardware-wallet-nfc-satscard-signing-device>Hardware Wallet (NFC SatochipSigning
Device)</a></li><li><a href=#stateless-server>Stateless Server</a></li></ul></li><li><a href=#musig2-protocol-integration>MuSig2 Protocol Integration</a></li><li><a href=#wallet-configurations>Wallet Configurations</a><ul><li><a href=#2-of-2-configuration>2-of-2 Configuration</a></li><li><a href=#2-of-3-configuration>2-of-3 Configuration</a></li></ul></li><li><a href=#decaying-multisig-with-csv-timelocks>Decaying Multisig with CSV Timelocks</a></li><li><a href=#security-analysis>Security Analysis</a></li><li><a href=#recovery-scenarios>Recovery Scenarios</a></li><li><a href=#comparison-with-existing-solutions>Comparison with Existing Solutions</a></li><li><a href=#implementation-considerations>Implementation Considerations</a></li></ol><hr><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>Traditional Bitcoin wallets face a fundamental tension between
<strong>security</strong> and <strong>usability</strong>. Single-signature wallets are
vulnerable to key theft, while multisig wallets can lock users out of
their funds if keys are lost. Nuri Wallet resolves this tension
through an innovative combination of:</p><ul><li><strong>Stateless key derivation</strong>: No persistent key storage means no
keys to steal from rest</li><li><strong>MuSig2 aggregated signatures</strong>: Multiple parties contribute to a
single Schnorr signature, maintaining privacy and reducing transaction
fees</li><li><strong>Decaying timelocks</strong>: Graduated recovery options that balance
security against lockout risk</li><li><strong>Hardware wallet integration</strong>: Optional cold storage for maximum security</li></ul><hr><h2 id=architecture-overview>Architecture Overview<a hidden class=anchor aria-hidden=true href=#architecture-overview>#</a></h2><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           NURI WALLET ARCHITECTURE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   PASSKEY KEY    â”‚  â”‚  HARDWARE KEY    â”‚  â”‚   SERVER KEY     â”‚          â”‚
â”‚  â”‚   (Stateless)    â”‚  â”‚  (NFC Satochip)  â”‚  â”‚   (Stateless)    â”‚          â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
â”‚  â”‚ WebAuthn PRF     â”‚  â”‚ Secure Element   â”‚  â”‚ HSM/Secure       â”‚          â”‚
â”‚  â”‚ Extension        â”‚  â”‚ on NFC Card      â”‚  â”‚ Element          â”‚          â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚          â”‚
â”‚  â”‚ key = PRF(salt)  â”‚  â”‚ Private key      â”‚  â”‚ key = f(user_id, â”‚          â”‚
â”‚  â”‚                  â”‚  â”‚ never leaves     â”‚  â”‚        entropy)  â”‚          â”‚
â”‚  â”‚ No key storage   â”‚  â”‚ the chip         â”‚  â”‚                  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚           â”‚                     â”‚                     â”‚                     â”‚
â”‚           â”‚    MuSig2 Partial   â”‚    MuSig2 Partial   â”‚                     â”‚
â”‚           â”‚    Signature        â”‚    Signature        â”‚                     â”‚
â”‚           â”‚                     â”‚                     â”‚                     â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                      â”‚                     â”‚                                â”‚
â”‚                      â–¼                     â–¼                                â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚           â”‚         MuSig2 SIGNATURE AGGREGATION    â”‚                       â”‚
â”‚           â”‚                                         â”‚                       â”‚
â”‚           â”‚  2-of-2: Passkey + Server               â”‚                       â”‚
â”‚           â”‚  2-of-3: Any 2 of {Passkey, HW, Server} â”‚                       â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    DECAYING TIMELOCK STRUCTURE                       â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚   T=0                    T=10,000 blocks              T=52,560       â”‚   â”‚
â”‚  â”‚    â”‚                          â”‚                       blocks         â”‚   â”‚
â”‚  â”‚    â–¼                          â–¼                          â–¼           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  NORMAL OPERATION  â”‚  RECOVERY MODE        â”‚  EMERGENCY EXIT â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  2-of-2 or 2-of-3  â”‚  Passkey + HW         â”‚  Passkey only   â”‚   â”‚
â”‚  â”‚  â”‚  (Server active)   â”‚  (Server unavailable) â”‚  (CSV expired)  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><hr><h2 id=key-components>Key Components<a hidden class=anchor aria-hidden=true href=#key-components>#</a></h2><h3 id=stateless-passkey-wallet>Stateless Passkey Wallet<a hidden class=anchor aria-hidden=true href=#stateless-passkey-wallet>#</a></h3><p>The passkey-based key is the cornerstone of Nuri&rsquo;s user experience. It
leverages the <strong>WebAuthn PRF (Pseudo-Random Function) extension</strong> to
derive cryptographic keys without ever storing them.</p><h4 id=how-it-works>How It Works<a hidden class=anchor aria-hidden=true href=#how-it-works>#</a></h4><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PASSKEY KEY DERIVATION                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   User authenticates with passkey (biometric/PIN)               â”‚
â”‚                          â”‚                                      â”‚
â”‚                          â–¼                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚         WebAuthn Authenticator          â”‚                  â”‚
â”‚   â”‚    (Platform or Roaming Authenticator)  â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                          â”‚                                      â”‚
â”‚                          â–¼                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚           PRF Extension                 â”‚                  â”‚
â”‚   â”‚                                         â”‚                  â”‚
â”‚   â”‚   secret = HMAC-SHA256(device_secret,   â”‚                  â”‚
â”‚   â”‚                        salt || rpId)    â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                          â”‚                                      â”‚
â”‚                          â–¼                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚      Bitcoin Key Derivation             â”‚                  â”‚
â”‚   â”‚                                         â”‚                  â”‚
â”‚   â”‚   private_key = HKDF(secret,            â”‚                  â”‚
â”‚   â”‚                      &#34;nuri-bitcoin&#34;,    â”‚                  â”‚
â”‚   â”‚                      derivation_path)   â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><h4 id=security-properties>Security Properties<a hidden class=anchor aria-hidden=true href=#security-properties>#</a></h4><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td><strong>Stateless</strong></td><td>No private keys stored on device; derived on-demand</td></tr><tr><td><strong>Phishing Resistant</strong></td><td>WebAuthn binds credentials to origin</td></tr><tr><td><strong>Hardware-Backed</strong></td><td>PRF secret stored in device secure element</td></tr><tr><td><strong>Biometric Protected</strong></td><td>User presence verified via fingerprint/face</td></tr></tbody></table><h4 id=key-derivation-formula>Key Derivation Formula<a hidden class=anchor aria-hidden=true href=#key-derivation-formula>#</a></h4><p>Given:</p><ul><li>$s$ = device master secret (in secure element)</li><li>$\text{salt}$ = application-specific salt</li><li>$\text{rpId}$ = relying party identifier</li></ul><p>The PRF output is:</p><p>$$\text{prf_output} = \text{HMAC-SHA256}(s, \text{salt} | \text{rpId})$$</p><p>The Bitcoin private key is then derived as:</p><p>$$k_{\text{passkey}} = \text{HKDF-SHA256}(\text{prf_output},
\text{&ldquo;nuri-btc-v1&rdquo;}, \text{path})$$</p><hr><h3 id=hardware-wallet-nfc-satochip-signing-device>Hardware Wallet (NFC Satochip Signing Device)<a hidden class=anchor aria-hidden=true href=#hardware-wallet-nfc-satochip-signing-device>#</a></h3><p>The hardware wallet component uses an <strong>NFC-based secure element
card</strong> (similar to Satochip or SatSigner) that performs <strong>MuSig2
partial signing</strong> without ever exposing its private key.</p><h4 id=capabilities>Capabilities<a hidden class=anchor aria-hidden=true href=#capabilities>#</a></h4><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  NFC HARDWARE WALLET                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚   â”‚   Secure Element    â”‚                                      â”‚
â”‚   â”‚   (JavaCard/etc)    â”‚                                      â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                      â”‚
â”‚   â”‚ â€¢ Private key       â”‚  â—„â”€â”€ Never leaves the chip           â”‚
â”‚   â”‚   generation        â”‚                                      â”‚
â”‚   â”‚ â€¢ MuSig2 nonce      â”‚                                      â”‚
â”‚   â”‚   generation        â”‚                                      â”‚
â”‚   â”‚ â€¢ Partial signature â”‚                                      â”‚
â”‚   â”‚   creation          â”‚                                      â”‚
â”‚   â”‚ â€¢ Public key export â”‚                                      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚            â–²                                                    â”‚
â”‚            â”‚ NFC                                                â”‚
â”‚            â–¼                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚   â”‚   Mobile Device     â”‚                                      â”‚
â”‚   â”‚   (Nuri App)        â”‚                                      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><h4 id=musig2-signing-flow>MuSig2 Signing Flow<a hidden class=anchor aria-hidden=true href=#musig2-signing-flow>#</a></h4><ol><li><strong>Nonce Commitment Round</strong>: Card generates random nonce
$R_{\text{hw}}$ and provides commitment</li><li><strong>Nonce Exchange</strong>: All parties exchange nonce commitments, then
reveal nonces</li><li><strong>Partial Signing</strong>: Card computes partial signature without
revealing private key</li><li><strong>Aggregation</strong>: Partial signatures combined into final Schnorr signature</li></ol><hr><h3 id=stateless-server>Stateless Server<a hidden class=anchor aria-hidden=true href=#stateless-server>#</a></h3><p>The server acts as a <strong>2FA-protected co-signer</strong> that adds entropy and
provides an additional security layer without introducing custody
risk.</p><h4 id=design-principles>Design Principles<a hidden class=anchor aria-hidden=true href=#design-principles>#</a></h4><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STATELESS SERVER                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚         Hardware Security Module        â”‚                  â”‚
â”‚   â”‚              (HSM)                       â”‚                  â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
â”‚   â”‚ â€¢ Master seed (never exported)          â”‚                  â”‚
â”‚   â”‚ â€¢ Deterministic key derivation          â”‚                  â”‚
â”‚   â”‚ â€¢ Rate limiting                         â”‚                  â”‚
â”‚   â”‚ â€¢ Audit logging                         â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                          â”‚                                      â”‚
â”‚                          â–¼                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚      Key Derivation Function            â”‚                  â”‚
â”‚   â”‚                                         â”‚                  â”‚
â”‚   â”‚   k_server = KDF(master_seed,           â”‚                  â”‚
â”‚   â”‚                  user_id,               â”‚                  â”‚
â”‚   â”‚                  wallet_id,             â”‚                  â”‚
â”‚   â”‚                  key_index)             â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â”‚   Properties:                                                   â”‚
â”‚   â€¢ No private keys stored in database                         â”‚
â”‚   â€¢ Keys derived on-demand from HSM                            â”‚
â”‚   â€¢ 2FA required before signing                                â”‚
â”‚   â€¢ Server breach doesn&#39;t compromise keys                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><h4 id=server-key-derivation>Server Key Derivation<a hidden class=anchor aria-hidden=true href=#server-key-derivation>#</a></h4><p>The server derives user-specific keys deterministically:</p><p>$$k_{\text{server}} = \text{HKDF}(k_{\text{master}}, \text{user_id}
| \text{wallet_id} | \text{index})$$</p><p>Where $k_{\text{master}}$ is stored in the HSM and never exported.</p><hr><h2 id=musig2-protocol-integration>MuSig2 Protocol Integration<a hidden class=anchor aria-hidden=true href=#musig2-protocol-integration>#</a></h2><p>MuSig2 is a <strong>multi-signature scheme</strong> that produces a single
aggregated Schnorr signature indistinguishable from a regular
signature. This provides both <strong>privacy</strong> (observers can&rsquo;t tell it&rsquo;s
multisig) and <strong>efficiency</strong> (smaller transactions, lower fees).</p><h3 id=musig2-overview>MuSig2 Overview<a hidden class=anchor aria-hidden=true href=#musig2-overview>#</a></h3><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     MuSig2 PROTOCOL                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   SETUP PHASE (one-time)                                        â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                        â”‚
â”‚                                                                 â”‚
â”‚   Each party i has:                                             â”‚
â”‚   â€¢ Private key: xáµ¢                                             â”‚
â”‚   â€¢ Public key:  Páµ¢ = xáµ¢ Â· G                                    â”‚
â”‚                                                                 â”‚
â”‚   Aggregated public key:                                        â”‚
â”‚   P = Î£áµ¢ (aáµ¢ Â· Páµ¢)                                              â”‚
â”‚   where aáµ¢ = H(L, Páµ¢) and L = {Pâ‚, Pâ‚‚, ...}                     â”‚
â”‚                                                                 â”‚
â”‚   SIGNING PHASE (per transaction)                               â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                               â”‚
â”‚                                                                 â”‚
â”‚   Round 1: Nonce Generation                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚   â”‚ Party 1 â”‚  â”‚ Party 2 â”‚  â”‚ Party 3 â”‚                        â”‚
â”‚   â”‚ râ‚ â†’ Râ‚ â”‚  â”‚ râ‚‚ â†’ Râ‚‚ â”‚  â”‚ râ‚ƒ â†’ Râ‚ƒ â”‚                        â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                        â”‚
â”‚        â”‚            â”‚            â”‚                              â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                     â–¼                                           â”‚
â”‚              Exchange Ráµ¢ values                                 â”‚
â”‚                     â”‚                                           â”‚
â”‚                     â–¼                                           â”‚
â”‚   Round 2: Partial Signatures                                   â”‚
â”‚                                                                 â”‚
â”‚   R = Î£áµ¢ Ráµ¢  (aggregated nonce)                                 â”‚
â”‚   c = H(R, P, m)  (challenge)                                   â”‚
â”‚                                                                 â”‚
â”‚   Each party computes:                                          â”‚
â”‚   sáµ¢ = ráµ¢ + c Â· aáµ¢ Â· xáµ¢                                         â”‚
â”‚                                                                 â”‚
â”‚   Final signature:                                              â”‚
â”‚   s = Î£áµ¢ sáµ¢                                                     â”‚
â”‚   Ïƒ = (R, s)                                                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><h3 id=why-musig2-for-nuri>Why MuSig2 for Nuri?<a hidden class=anchor aria-hidden=true href=#why-musig2-for-nuri>#</a></h3><table><thead><tr><th>Benefit</th><th>Description</th></tr></thead><tbody><tr><td><strong>Privacy</strong></td><td>Aggregated signature looks like single-sig on-chain</td></tr><tr><td><strong>Efficiency</strong></td><td>One signature regardless of number of signers</td></tr><tr><td><strong>Taproot Native</strong></td><td>Designed for Bitcoin&rsquo;s Schnorr/Taproot upgrade</td></tr><tr><td><strong>Non-Interactive</strong></td><td>Only 2 rounds of communication needed</td></tr></tbody></table><hr><h2 id=wallet-configurations>Wallet Configurations<a hidden class=anchor aria-hidden=true href=#wallet-configurations>#</a></h2><h3 id=2-of-2-configuration>2-of-2 Configuration<a hidden class=anchor aria-hidden=true href=#2-of-2-configuration>#</a></h3><p>The basic configuration requires both the <strong>passkey</strong> and <strong>server</strong>
to sign transactions.</p><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    2-of-2 CONFIGURATION                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   NORMAL OPERATION                                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚   â”‚  Passkey  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Server   â”‚                          â”‚
â”‚   â”‚   Key     â”‚  2FA    â”‚   Key     â”‚                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ verify  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚         â”‚                     â”‚                                 â”‚
â”‚         â”‚    MuSig2          â”‚                                 â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                    â–¼                                            â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚              â”‚ Combined â”‚                                       â”‚
â”‚              â”‚Signature â”‚                                       â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚                                                                 â”‚
â”‚   RECOVERY (Server Unavailable)                                 â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚
â”‚                                                                 â”‚
â”‚   After CSV timelock expires (~1 year):                         â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚   â”‚  Passkey  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Spend with single signature     â”‚
â”‚   â”‚   Key     â”‚                (CSV exit path)                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><h4 id=transaction-structure-taproot>Transaction Structure (Taproot)<a hidden class=anchor aria-hidden=true href=#transaction-structure-taproot>#</a></h4><pre tabindex=0><code>Output Script (P2TR):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OP_1 &lt;aggregated_pubkey&gt;                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Taproot Tree:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Internal Key                            â”‚
â”‚                    (MuSig2: Passkey + Server)                   â”‚
â”‚                              â”‚                                  â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚              â”‚                               â”‚                  â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚        â”‚  Leaf 1   â”‚                  â”‚   Leaf 2    â”‚           â”‚
â”‚        â”‚  (empty)  â”‚                  â”‚  CSV Exit   â”‚           â”‚
â”‚        â”‚           â”‚                  â”‚ &lt;pk_passkey&gt;â”‚           â”‚
â”‚        â”‚           â”‚                  â”‚ CHECKSIG    â”‚           â”‚
â”‚        â”‚           â”‚                  â”‚ &lt;52560&gt;     â”‚           â”‚
â”‚        â”‚           â”‚                  â”‚ CSV         â”‚           â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><hr><h3 id=2-of-3-configuration>2-of-3 Configuration<a hidden class=anchor aria-hidden=true href=#2-of-3-configuration>#</a></h3><p>The enhanced configuration adds a <strong>hardware wallet</strong> for additional
security and recovery options.</p><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    2-of-3 CONFIGURATION                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   THREE SIGNING KEYS                                            â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚   â”‚  Passkey  â”‚    â”‚ Hardware  â”‚    â”‚  Server   â”‚              â”‚
â”‚   â”‚   (Hot)   â”‚    â”‚  Wallet   â”‚    â”‚  (2FA)    â”‚              â”‚
â”‚   â”‚           â”‚    â”‚  (Cold)   â”‚    â”‚           â”‚              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                â”‚                â”‚                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                  â”‚               â”‚                              â”‚
â”‚                  â–¼               â–¼                              â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚         â”‚   ANY 2-of-3 can sign        â”‚                        â”‚
â”‚         â”‚                              â”‚                        â”‚
â”‚         â”‚   â€¢ Passkey + Server (daily) â”‚                        â”‚
â”‚         â”‚   â€¢ Passkey + HW (recovery)  â”‚                        â”‚
â”‚         â”‚   â€¢ Server + HW (if needed)  â”‚                        â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                 â”‚
â”‚   SIGNING SCENARIOS                                             â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
â”‚                                                                 â”‚
â”‚   Scenario 1: Normal (Passkey + Server)                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  2FA  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚   â”‚ Passkey â”œâ”€â”€â”€â”€â”€â”€â–¶â”‚ Server  â”‚â”€â”€â”€â”€â–¶ âœ“ Transaction             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                 â”‚
â”‚   Scenario 2: Server Down (Passkey + Hardware)                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  NFC  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚   â”‚ Passkey â”œâ”€â”€â”€â”€â”€â”€â–¶â”‚   HW    â”‚â”€â”€â”€â”€â–¶ âœ“ Transaction             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      (No waiting!)             â”‚
â”‚                                                                 â”‚
â”‚   Scenario 3: Passkey Lost (Hardware + Server)                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚   â”‚   HW    â”œâ”€â”€â”€â”€â”€â”€â–¶â”‚ Server  â”‚â”€â”€â”€â”€â–¶ âœ“ Transaction             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><h4 id=taproot-structure-for-2-of-3>Taproot Structure for 2-of-3<a hidden class=anchor aria-hidden=true href=#taproot-structure-for-2-of-3>#</a></h4><pre tabindex=0><code>Taproot Tree (2-of-3):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Internal Key                            â”‚
â”‚              (MuSig2: Passkey + Server - default path)          â”‚
â”‚                              â”‚                                  â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚      â”‚                       â”‚                       â”‚          â”‚
â”‚ â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Leaf 1  â”‚           â”‚   Leaf 2    â”‚         â”‚   Leaf 3    â”‚   â”‚
â”‚ â”‚Passkey+ â”‚           â”‚ Passkey+    â”‚         â”‚  CSV Exit   â”‚   â”‚
â”‚ â”‚  HW     â”‚           â”‚  Server     â”‚         â”‚&lt;pk_passkey&gt; â”‚   â”‚
â”‚ â”‚(MuSig2) â”‚           â”‚ (redundant) â”‚         â”‚ CHECKSIG    â”‚   â”‚
â”‚ â”‚         â”‚           â”‚             â”‚         â”‚ &lt;52560&gt; CSV â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚ Note: Server+HW combination handled via Leaf 2 alternative      â”‚
â”‚       or additional leaf as needed                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><hr><h2 id=decaying-multisig-with-csv-timelocks>Decaying Multisig with CSV Timelocks<a hidden class=anchor aria-hidden=true href=#decaying-multisig-with-csv-timelocks>#</a></h2><p>The <strong>decaying multisig</strong> pattern ensures that users can always
recover their funds, with security guarantees that gracefully degrade
over time.</p><h3 id=how-csv-checksequenceverify-works>How CSV (CheckSequenceVerify) Works<a hidden class=anchor aria-hidden=true href=#how-csv-checksequenceverify-works>#</a></h3><p>CSV enforces a <strong>relative timelock</strong> measured in blocks since the UTXO
was created:</p><p>$$\text{spendable_height} = \text{confirmation_height} + \text{csv_blocks}$$</p><p>For Nuri Wallet:</p><ul><li><strong>Normal operation</strong>: 2-of-2 or 2-of-3 MuSig2 required</li><li><strong>After ~70 days</strong> (10,000 blocks): Alternative recovery paths activate</li><li><strong>After ~1 year</strong> (52,560 blocks): Single-key emergency exit available</li></ul><h3 id=timelock-visualization>Timelock Visualization<a hidden class=anchor aria-hidden=true href=#timelock-visualization>#</a></h3><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DECAYING SECURITY MODEL                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Security                                                       â”‚
â”‚  Level                                                          â”‚
â”‚    â–²                                                            â”‚
â”‚    â”‚                                                            â”‚
â”‚  3 â”¤ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”                                      â”‚
â”‚    â”‚                     â”‚                                      â”‚
â”‚  2 â”¤                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   2-of-3 config  â”‚
â”‚    â”‚                                         â”‚   (HW available) â”‚
â”‚    â”‚                                         â”‚                  â”‚
â”‚  1 â”¤                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚    â”‚                                                            â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶       â”‚
â”‚         T=0            T=10,000         T=52,560      Time      â”‚
â”‚         â”‚              blocks           blocks        (blocks)  â”‚
â”‚         â”‚              (~70 days)       (~1 year)               â”‚
â”‚         â”‚                 â”‚                â”‚                    â”‚
â”‚         â–¼                 â–¼                â–¼                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚ Maximum  â”‚     â”‚ HW Recovery  â”‚  â”‚  Emergency   â”‚          â”‚
â”‚   â”‚ Security â”‚     â”‚  Available   â”‚  â”‚    Exit      â”‚          â”‚
â”‚   â”‚  2FA +   â”‚     â”‚ No server    â”‚  â”‚  Passkey     â”‚          â”‚
â”‚   â”‚ Passkey  â”‚     â”‚   needed     â”‚  â”‚    only      â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><h3 id=script-structure>Script Structure<a hidden class=anchor aria-hidden=true href=#script-structure>#</a></h3><p><strong>CSV Exit Script (simplified):</strong></p><pre tabindex=0><code>OP_IF
    // Normal spending path: requires aggregated MuSig2 signature
    &lt;aggregated_pubkey&gt;
    OP_CHECKSIG
OP_ELSE
    // Emergency exit: after timelock, passkey alone can spend
    &lt;52560&gt;           // ~1 year in blocks
    OP_CHECKSEQUENCEVERIFY
    OP_DROP
    &lt;passkey_pubkey&gt;
    OP_CHECKSIG
OP_ENDIF
</code></pre><h3 id=re-locking-mechanism>Re-locking Mechanism<a hidden class=anchor aria-hidden=true href=#re-locking-mechanism>#</a></h3><p>To maintain maximum security, users should periodically &ldquo;refresh&rdquo; their UTXOs:</p><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UTXO REFRESH CYCLE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Initial Deposit          After 11 months         Re-deposit  â”‚
â”‚        â”‚                        â”‚                       â”‚       â”‚
â”‚        â–¼                        â–¼                       â–¼       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚  UTXO   â”‚   Time       â”‚  UTXO   â”‚   Self-    â”‚  UTXO   â”‚ â”‚
â”‚   â”‚  CSV=0  â”‚  â”€â”€â”€â”€â”€â–¶      â”‚CSV=47520â”‚   send     â”‚  CSV=0  â”‚ â”‚
â”‚   â”‚         â”‚              â”‚ (aging) â”‚  â”€â”€â”€â”€â”€â–¶    â”‚ (fresh) â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚   Security: MAX            Security: Degrading    Security: MAXâ”‚
â”‚                                                                 â”‚
â”‚   Wallet prompts user when UTXOs approach timelock expiry      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><hr><h2 id=security-analysis>Security Analysis<a hidden class=anchor aria-hidden=true href=#security-analysis>#</a></h2><h3 id=threat-model>Threat Model<a hidden class=anchor aria-hidden=true href=#threat-model>#</a></h3><table><thead><tr><th>Threat</th><th>Mitigation</th></tr></thead><tbody><tr><td><strong>Device theft</strong></td><td>Passkey protected by biometrics; key derived on-demand</td></tr><tr><td><strong>Server compromise</strong></td><td>Server keys in HSM; stateless derivation;</td></tr><tr><td>server alone cannot spend</td><td></td></tr><tr><td><strong>Phishing</strong></td><td>WebAuthn origin binding prevents credential theft</td></tr><tr><td><strong>Man-in-the-middle</strong></td><td>MuSig2 nonce protocol prevents signature forgery</td></tr><tr><td><strong>Server disappearance</strong></td><td>CSV timelock enables recovery; HW wallet</td></tr><tr><td>provides immediate alternative</td><td></td></tr><tr><td><strong>Hardware wallet loss</strong></td><td>2-of-3 allows recovery with passkey + server</td></tr><tr><td><strong>Passkey loss</strong></td><td>2-of-3 allows recovery with HW + server</td></tr></tbody></table><h3 id=security-levels-by-configuration>Security Levels by Configuration<a hidden class=anchor aria-hidden=true href=#security-levels-by-configuration>#</a></h3><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                SECURITY COMPARISON                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                    2-of-2           2-of-3                      â”‚
â”‚                    â”€â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€â”€                      â”‚
â”‚                                                                 â”‚
â”‚   Keys Required      2                2                         â”‚
â”‚   to Spend                                                      â”‚
â”‚                                                                 â”‚
â”‚   Single Point       Passkey         None                       â”‚
â”‚   of Failure         (for CSV exit)  (any 2 keys work)          â”‚
â”‚                                                                 â”‚
â”‚   Server Down        Wait ~1 year    Use Passkey + HW           â”‚
â”‚   Recovery                           (immediate)                â”‚
â”‚                                                                 â”‚
â”‚   Passkey Lost       Funds locked    Use Server + HW            â”‚
â”‚   Recovery           (CSV doesn&#39;t    (immediate)                â”‚
â”‚                      help here!)                                â”‚
â”‚                                                                 â”‚
â”‚   Best For           Simplicity,     Maximum security,          â”‚
â”‚                      casual users    significant holdings       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><h3 id=attack-scenarios>Attack Scenarios<a hidden class=anchor aria-hidden=true href=#attack-scenarios>#</a></h3><h4 id=scenario-1-attacker-compromises-server>Scenario 1: Attacker Compromises Server<a hidden class=anchor aria-hidden=true href=#scenario-1-attacker-compromises-server>#</a></h4><pre tabindex=0><code>Attacker obtains: Server signing capability
Attacker needs:   Passkey authentication OR Hardware wallet

Result: âŒ Cannot steal funds (missing second key)
        âš ï¸  Can potentially DoS by refusing to sign
        âœ… User recovers via CSV exit or HW wallet
</code></pre><h4 id=scenario-2-attacker-steals-phone>Scenario 2: Attacker Steals Phone<a hidden class=anchor aria-hidden=true href=#scenario-2-attacker-steals-phone>#</a></h4><pre tabindex=0><code>Attacker obtains: Physical device
Attacker needs:   Biometric/PIN to unlock passkey
                  PLUS 2FA to authorize server signing

Result: âŒ Cannot steal funds (passkey protected by biometrics)
        âœ… Keys never stored on device (stateless)
</code></pre><h4 id=scenario-3-attacker-compromises-both-passkey-and-server>Scenario 3: Attacker Compromises Both Passkey AND Server<a hidden class=anchor aria-hidden=true href=#scenario-3-attacker-compromises-both-passkey-and-server>#</a></h4><pre tabindex=0><code>Attacker obtains: Passkey credential + Server access
Result: âš ï¸  Can steal funds in 2-of-2 config
        âœ… 2-of-3 config: HW wallet still required
</code></pre><hr><h2 id=recovery-scenarios>Recovery Scenarios<a hidden class=anchor aria-hidden=true href=#recovery-scenarios>#</a></h2><h3 id=complete-recovery-matrix>Complete Recovery Matrix<a hidden class=anchor aria-hidden=true href=#complete-recovery-matrix>#</a></h3><table><thead><tr><th>Scenario</th><th>2-of-2 Config</th><th>2-of-3 Config</th></tr></thead><tbody><tr><td><strong>Lost phone (passkey)</strong></td><td>Wait for CSV (~1 year), then&mldr; âŒ still</td><td></td></tr><tr><td>can&rsquo;t spend!</td><td>Server + HW âœ…</td><td></td></tr><tr><td><strong>Server goes offline</strong></td><td>Wait for CSV (~1 year) âœ…</td><td>Passkey + HW âœ…</td></tr><tr><td>(immediate)</td><td></td><td></td></tr><tr><td><strong>Lost hardware wallet</strong></td><td>N/A (not in config)</td><td>Passkey + Server âœ…</td></tr><tr><td><strong>Lost phone + server down</strong></td><td>âŒ Funds lost</td><td>HW can spend after</td></tr><tr><td>CSV? (design decision)</td><td></td><td></td></tr><tr><td><strong>Lost HW + server down</strong></td><td>Wait for CSV âœ…</td><td>Wait for CSV âœ…</td></tr></tbody></table><h3 id=recovery-flow-server-unavailable-2-of-3>Recovery Flow: Server Unavailable (2-of-3)<a hidden class=anchor aria-hidden=true href=#recovery-flow-server-unavailable-2-of-3>#</a></h3><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          RECOVERY: SERVER UNAVAILABLE (2-of-3)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Step 1: Detect server unavailability                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚ App: &#34;Server unreachable. Use hardware  â”‚                  â”‚
â”‚   â”‚       wallet for recovery signing?&#34;     â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â”‚   Step 2: Authenticate with passkey                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚ User: [Biometric authentication]        â”‚                  â”‚
â”‚   â”‚ App:  Derives passkey private key       â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â”‚   Step 3: Tap NFC hardware wallet                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚ App: &#34;Tap your Nuri Card to sign&#34;       â”‚                  â”‚
â”‚   â”‚                                         â”‚                  â”‚
â”‚   â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚                  â”‚
â”‚   â”‚        â”‚  ğŸ“± â†â†’ ğŸ’³ â”‚  NFC               â”‚                  â”‚
â”‚   â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â”‚   Step 4: MuSig2 signing between Passkey + HW                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚ Passkey partial sig + HW partial sig    â”‚                  â”‚
â”‚   â”‚              â†“                          â”‚                  â”‚
â”‚   â”‚    Aggregated Schnorr signature         â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â”‚   Step 5: Broadcast transaction                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚ Transaction broadcast to Bitcoin networkâ”‚                  â”‚
â”‚   â”‚ âœ… Funds recovered without server       â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><h3 id=recovery-flow-csv-emergency-exit-2-of-2>Recovery Flow: CSV Emergency Exit (2-of-2)<a hidden class=anchor aria-hidden=true href=#recovery-flow-csv-emergency-exit-2-of-2>#</a></h3><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RECOVERY: CSV EMERGENCY EXIT                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Prerequisites:                                                â”‚
â”‚   â€¢ Server has been unavailable for extended period             â”‚
â”‚   â€¢ UTXO age &gt; 52,560 blocks (~1 year)                          â”‚
â”‚   â€¢ User still has passkey access                               â”‚
â”‚                                                                 â”‚
â”‚   Step 1: Check UTXO eligibility                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚ App scans UTXOs for CSV-eligible funds  â”‚                  â”‚
â”‚   â”‚                                         â”‚                  â”‚
â”‚   â”‚ UTXO 1: 0.5 BTC  - Age: 55,000 blocks âœ…â”‚                  â”‚
â”‚   â”‚ UTXO 2: 0.3 BTC  - Age: 40,000 blocks âŒâ”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â”‚   Step 2: Construct CSV spending transaction                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚ Input: UTXO with nSequence = 52,560     â”‚                  â”‚
â”‚   â”‚ Witness: &lt;passkey_signature&gt; &lt;csv_script&gt;â”‚                  â”‚
â”‚   â”‚ Output: New address controlled by user  â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â”‚   Step 3: Sign with passkey only                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚ No server needed - single signature     â”‚                  â”‚
â”‚   â”‚ sufficient for CSV exit path            â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â”‚   Step 4: Broadcast and confirm                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚ Transaction valid because:              â”‚                  â”‚
â”‚   â”‚ â€¢ CSV timelock satisfied                â”‚                  â”‚
â”‚   â”‚ â€¢ Valid passkey signature provided      â”‚                  â”‚
â”‚   â”‚ âœ… Funds recovered!                     â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><hr><h2 id=comparison-with-existing-solutions>Comparison with Existing Solutions<a hidden class=anchor aria-hidden=true href=#comparison-with-existing-solutions>#</a></h2><h3 id=nuri-vs-blockstream-green>Nuri vs. Blockstream Green<a hidden class=anchor aria-hidden=true href=#nuri-vs-blockstream-green>#</a></h3><table><thead><tr><th>Feature</th><th>Blockstream Green</th><th>Nuri Wallet</th></tr></thead><tbody><tr><td><strong>Signature Scheme</strong></td><td>ECDSA multisig</td><td>MuSig2 Schnorr</td></tr><tr><td><strong>On-chain Footprint</strong></td><td>Visible multisig</td><td>Single-sig appearance</td></tr><tr><td><strong>Client Key Storage</strong></td><td>Encrypted on device</td><td>Stateless (PRF-derived)</td></tr><tr><td><strong>Server Key Storage</strong></td><td>Traditional HSM</td><td>Stateless HSM derivation</td></tr><tr><td><strong>Recovery (2-of-2)</strong></td><td>CSV timelock</td><td>CSV timelock</td></tr><tr><td><strong>Recovery (2-of-3)</strong></td><td>Backup key phrase</td><td>Hardware wallet</td></tr><tr><td><strong>Taproot Support</strong></td><td>Limited</td><td>Native</td></tr></tbody></table><h3 id=nuri-vs-traditional-hardware-wallets>Nuri vs. Traditional Hardware Wallets<a hidden class=anchor aria-hidden=true href=#nuri-vs-traditional-hardware-wallets>#</a></h3><table><thead><tr><th>Feature</th><th>Ledger/Trezor</th><th>Nuri Wallet</th></tr></thead><tbody><tr><td><strong>Form Factor</strong></td><td>Dedicated device</td><td>Passkey + NFC card</td></tr><tr><td><strong>Daily Transactions</strong></td><td>Device required</td><td>Passkey only (server 2FA)</td></tr><tr><td><strong>High-Value Transactions</strong></td><td>Same as daily</td><td>Can require HW card</td></tr><tr><td><strong>Loss Recovery</strong></td><td>Seed phrase</td><td>Multiple paths (CSV, 2-of-3)</td></tr><tr><td><strong>Theft Risk</strong></td><td>Seed phrase exposure</td><td>No seed phrase needed</td></tr></tbody></table><h3 id=nuri-vs-custodial-solutions>Nuri vs. Custodial Solutions<a hidden class=anchor aria-hidden=true href=#nuri-vs-custodial-solutions>#</a></h3><table><thead><tr><th>Feature</th><th>Custodial Exchange</th><th>Nuri Wallet</th></tr></thead><tbody><tr><td><strong>Key Control</strong></td><td>Exchange holds keys</td><td>User holds all keys</td></tr><tr><td><strong>Counterparty Risk</strong></td><td>High</td><td>None</td></tr><tr><td><strong>Regulatory Risk</strong></td><td>Subject to seizure</td><td>Self-sovereign</td></tr><tr><td><strong>Recovery</strong></td><td>Account recovery</td><td>CSV + multisig</td></tr><tr><td><strong>Privacy</strong></td><td>KYC required</td><td>No KYC for self-custody</td></tr></tbody></table><hr><h2 id=implementation-considerations>Implementation Considerations<a hidden class=anchor aria-hidden=true href=#implementation-considerations>#</a></h2><h3 id=webauthn-prf-browser-support>WebAuthn PRF Browser Support<a hidden class=anchor aria-hidden=true href=#webauthn-prf-browser-support>#</a></h3><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 WEBAUTHN PRF SUPPORT STATUS                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Browser/Platform          PRF Support    Notes                â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€                â”‚
â”‚   Chrome (Desktop)          âœ… Yes         Windows Hello, etc.  â”‚
â”‚   Chrome (Android)          âœ… Yes         Fingerprint/PIN      â”‚
â”‚   Safari (macOS)            âœ… Yes         Touch ID             â”‚
â”‚   Safari (iOS)              âœ… Yes         Face ID/Touch ID     â”‚
â”‚   Firefox                   âš ï¸ Partial     Platform dependent   â”‚
â”‚   Security Keys             âš ï¸ Varies      FIDO2 Level 2 req.   â”‚
â”‚                                                                 â”‚
â”‚   Fallback Strategy:                                            â”‚
â”‚   â€¢ Detect PRF support at registration                          â”‚
â”‚   â€¢ Fall back to encrypted key storage if unavailable           â”‚
â”‚   â€¢ Clearly communicate security implications to user           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><h3 id=musig2-implementation-notes>MuSig2 Implementation Notes<a hidden class=anchor aria-hidden=true href=#musig2-implementation-notes>#</a></h3><p><strong>Key Aggregation:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// Simplified MuSig2 key aggregation
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>aggregateKeys</span>(<span style=color:#a6e22e>pubkeys</span>: <span style=color:#66d9ef>Uint8Array</span>[])<span style=color:#f92672>:</span> <span style=color:#a6e22e>Uint8Array</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Sort pubkeys lexicographically for determinism
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>sortedKeys</span> <span style=color:#f92672>=</span> [...<span style=color:#a6e22e>pubkeys</span>].<span style=color:#a6e22e>sort</span>(<span style=color:#a6e22e>compareBytes</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Compute key aggregation coefficients
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>L</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>hashKeys</span>(<span style=color:#a6e22e>sortedKeys</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Aggregate with coefficients
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>aggregated</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Point</span>.<span style=color:#a6e22e>ZERO</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>pk</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>sortedKeys</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>P</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Point</span>.<span style=color:#a6e22e>fromBytes</span>(<span style=color:#a6e22e>pk</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>computeCoefficient</span>(<span style=color:#a6e22e>L</span>, <span style=color:#a6e22e>pk</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>aggregated</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>aggregated</span>.<span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>P</span>.<span style=color:#a6e22e>multiply</span>(<span style=color:#a6e22e>a</span>));
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>aggregated</span>.<span style=color:#a6e22e>toBytes</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Nonce Generation (Critical for Security):</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// MuSig2 requires fresh, unpredictable nonces
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>generateNonce</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>secretKey</span>: <span style=color:#66d9ef>Uint8Array</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>publicKey</span>: <span style=color:#66d9ef>Uint8Array</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>message</span>: <span style=color:#66d9ef>Uint8Array</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>extraRand</span>: <span style=color:#66d9ef>Uint8Array</span>
</span></span><span style=display:flex><span>)<span style=color:#f92672>:</span> { <span style=color:#a6e22e>secretNonce</span>: <span style=color:#66d9ef>Uint8Array</span>; <span style=color:#a6e22e>publicNonce</span>: <span style=color:#66d9ef>Uint8Array</span> } {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// MUST use fresh randomness for each signing session
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>rand</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>crypto</span>.<span style=color:#a6e22e>getRandomValues</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Uint8Array</span>(<span style=color:#ae81ff>32</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Derive nonce deterministically from inputs + randomness
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>k</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>taggedHash</span>(
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;MuSig2/nonce&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>concat</span>(<span style=color:#a6e22e>secretKey</span>, <span style=color:#a6e22e>publicKey</span>, <span style=color:#a6e22e>message</span>, <span style=color:#a6e22e>rand</span>, <span style=color:#a6e22e>extraRand</span>)
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>secretNonce</span>: <span style=color:#66d9ef>k</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>publicNonce</span>: <span style=color:#66d9ef>Point.BASE.multiply</span>(<span style=color:#a6e22e>k</span>).<span style=color:#a6e22e>toBytes</span>()
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=nfc-hardware-wallet-protocol>NFC Hardware Wallet Protocol<a hidden class=anchor aria-hidden=true href=#nfc-hardware-wallet-protocol>#</a></h3><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              NFC SIGNING PROTOCOL (APDU)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Command                    Response                           â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€                           â”‚
â”‚                                                                 â”‚
â”‚   SELECT APPLET              OK + Version                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”‚ CLA: 00        â”‚   â”€â”€â–¶   â”‚ SW: 9000       â”‚                â”‚
â”‚   â”‚ INS: A4        â”‚         â”‚ Version: 1.0   â”‚                â”‚
â”‚   â”‚ AID: Nuri...   â”‚         â”‚                â”‚                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                 â”‚
â”‚   GET PUBLIC KEY             Public Key                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”‚ CLA: E0        â”‚   â”€â”€â–¶   â”‚ SW: 9000       â”‚                â”‚
â”‚   â”‚ INS: 40        â”‚         â”‚ PubKey: 33B    â”‚                â”‚
â”‚   â”‚ Path: m/86&#39;/...â”‚         â”‚                â”‚                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                 â”‚
â”‚   MUSIG2 NONCE               Nonce Commitment                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”‚ CLA: E0        â”‚   â”€â”€â–¶   â”‚ SW: 9000       â”‚                â”‚
â”‚   â”‚ INS: 50        â”‚         â”‚ R: 33B         â”‚                â”‚
â”‚   â”‚ SessionID      â”‚         â”‚                â”‚                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                 â”‚
â”‚   MUSIG2 SIGN                Partial Signature                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”‚ CLA: E0        â”‚   â”€â”€â–¶   â”‚ SW: 9000       â”‚                â”‚
â”‚   â”‚ INS: 52        â”‚         â”‚ s: 32B         â”‚                â”‚
â”‚   â”‚ Message hash   â”‚         â”‚                â”‚                â”‚
â”‚   â”‚ Agg nonce      â”‚         â”‚                â”‚                â”‚
â”‚   â”‚ Agg pubkey     â”‚         â”‚                â”‚                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><hr><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>Nuri Wallet represents a significant advancement in Bitcoin
self-custody, combining:</p><ol><li><strong>Stateless Security</strong>: No persistent key storage reduces attack surface</li><li><strong>Multi-Party Signing</strong>: MuSig2 provides privacy and efficiency</li><li><strong>Graceful Degradation</strong>: Decaying timelocks ensure recovery is
always possible</li><li><strong>Flexible Security</strong>: 2-of-2 and 2-of-3 configurations for different needs</li></ol><p>The architecture ensures that users maintain full sovereignty over
their Bitcoin while benefiting from the security of multi-signature
protection and the convenience of modern authentication methods.</p><hr><h2 id=appendix-a-glossary>Appendix A: Glossary<a hidden class=anchor aria-hidden=true href=#appendix-a-glossary>#</a></h2><table><thead><tr><th>Term</th><th>Definition</th></tr></thead><tbody><tr><td><strong>CSV</strong></td><td>CheckSequenceVerify; Bitcoin opcode for relative timelocks</td></tr><tr><td><strong>HSM</strong></td><td>Hardware Security Module; tamper-resistant key storage</td></tr><tr><td><strong>MuSig2</strong></td><td>Multi-signature scheme for Schnorr signatures</td></tr><tr><td><strong>PRF</strong></td><td>Pseudo-Random Function; WebAuthn extension for key derivation</td></tr><tr><td><strong>Taproot</strong></td><td>Bitcoin upgrade enabling Schnorr signatures and MAST</td></tr><tr><td><strong>UTXO</strong></td><td>Unspent Transaction Output; Bitcoin&rsquo;s accounting model</td></tr><tr><td><strong>WebAuthn</strong></td><td>Web Authentication standard for passwordless auth</td></tr></tbody></table><hr><h2 id=appendix-b-references>Appendix B: References<a hidden class=anchor aria-hidden=true href=#appendix-b-references>#</a></h2><ol><li><a href=https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki>BIP-340: Schnorr Signatures for
secp256k1</a></li><li><a href=https://github.com/bitcoin/bips/blob/master/bip-0341.mediawiki>BIP-341: Taproot</a></li><li><a href=https://github.com/bitcoin/bips/blob/master/bip-0327.mediawiki>BIP-327: MuSig2</a></li><li><a href=https://w3c.github.io/webauthn/#prf-extension>WebAuthn PRF Extension</a></li><li><a href=https://help.blockstream.com/hc/en-us/articles/900001391763>Blockstream Green Security
Model</a></li></ol><hr><p><em>Post created via email from <a href=mailto:emin@nuri.com>emin@nuri.com</a></em></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://emino.app/tags/email-post/>Email-Post</a></li></ul><nav class=paginav><a class=prev href=https://emino.app/posts/stateless-bitcoin-multisig-divergent-key-derivation-strategi/><span class=title>Â« Prev</span><br><span>Stateless Bitcoin Multisig: Divergent Key Derivation Strategies</span>
</a><a class=next href=https://emino.app/posts/die-unendliche-geschichte-des-universums/><span class=title>Next Â»</span><br><span>Die unendliche Geschichte des Universums</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Nuri Wallet: A Stateless MuSig2 Bitcoin Wallet with Decaying Multisig Recovery on x" href="https://x.com/intent/tweet/?text=Nuri%20Wallet%3a%20A%20Stateless%20MuSig2%20Bitcoin%20Wallet%20with%20Decaying%20Multisig%20Recovery&amp;url=https%3a%2f%2femino.app%2fposts%2fnuri-wallet-a-stateless-musig2-bitcoin-wallet-with-decaying%2f&amp;hashtags=email-post"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Nuri Wallet: A Stateless MuSig2 Bitcoin Wallet with Decaying Multisig Recovery on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2femino.app%2fposts%2fnuri-wallet-a-stateless-musig2-bitcoin-wallet-with-decaying%2f&amp;title=Nuri%20Wallet%3a%20A%20Stateless%20MuSig2%20Bitcoin%20Wallet%20with%20Decaying%20Multisig%20Recovery&amp;summary=Nuri%20Wallet%3a%20A%20Stateless%20MuSig2%20Bitcoin%20Wallet%20with%20Decaying%20Multisig%20Recovery&amp;source=https%3a%2f%2femino.app%2fposts%2fnuri-wallet-a-stateless-musig2-bitcoin-wallet-with-decaying%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Nuri Wallet: A Stateless MuSig2 Bitcoin Wallet with Decaying Multisig Recovery on reddit" href="https://reddit.com/submit?url=https%3a%2f%2femino.app%2fposts%2fnuri-wallet-a-stateless-musig2-bitcoin-wallet-with-decaying%2f&title=Nuri%20Wallet%3a%20A%20Stateless%20MuSig2%20Bitcoin%20Wallet%20with%20Decaying%20Multisig%20Recovery"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Nuri Wallet: A Stateless MuSig2 Bitcoin Wallet with Decaying Multisig Recovery on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2femino.app%2fposts%2fnuri-wallet-a-stateless-musig2-bitcoin-wallet-with-decaying%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Nuri Wallet: A Stateless MuSig2 Bitcoin Wallet with Decaying Multisig Recovery on whatsapp" href="https://api.whatsapp.com/send?text=Nuri%20Wallet%3a%20A%20Stateless%20MuSig2%20Bitcoin%20Wallet%20with%20Decaying%20Multisig%20Recovery%20-%20https%3a%2f%2femino.app%2fposts%2fnuri-wallet-a-stateless-musig2-bitcoin-wallet-with-decaying%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Nuri Wallet: A Stateless MuSig2 Bitcoin Wallet with Decaying Multisig Recovery on telegram" href="https://telegram.me/share/url?text=Nuri%20Wallet%3a%20A%20Stateless%20MuSig2%20Bitcoin%20Wallet%20with%20Decaying%20Multisig%20Recovery&amp;url=https%3a%2f%2femino.app%2fposts%2fnuri-wallet-a-stateless-musig2-bitcoin-wallet-with-decaying%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Nuri Wallet: A Stateless MuSig2 Bitcoin Wallet with Decaying Multisig Recovery on ycombinator" href="https://news.ycombinator.com/submitlink?t=Nuri%20Wallet%3a%20A%20Stateless%20MuSig2%20Bitcoin%20Wallet%20with%20Decaying%20Multisig%20Recovery&u=https%3a%2f%2femino.app%2fposts%2fnuri-wallet-a-stateless-musig2-bitcoin-wallet-with-decaying%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://emino.app/>Art & Articles by Emin Mahrt</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>