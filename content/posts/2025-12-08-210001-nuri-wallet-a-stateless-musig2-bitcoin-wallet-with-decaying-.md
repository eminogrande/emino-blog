+++
title = "Nuri Wallet: A Stateless MuSig2 Bitcoin Wallet with Decaying Multisig Recovery"
date = 2025-12-08T21:00:01Z
draft = false
tags = ["email-post"]
categories = ["blog"]
slug = "nuri-wallet-a-stateless-musig2-bitcoin-wallet-with-decaying-"
markup = "markdown"
body_format = "markdown"
+++


Work in Progress. Document written by Opus 4.5

## Technical Design Document

---

## Executive Summary

Nuri Wallet is a next-generation Bitcoin wallet that combines **MuSig2
Schnorr signatures**, **stateless key derivation via WebAuthn PRF**,
**NFC hardware wallet integration**, and **server-assisted two-factor
authentication** into a unified security architecture. The design
prioritizes both security and recoverability through a **decaying
multisig** mechanism that ensures users can always recover their
funds, even if one or more signing components become unavailable.

---

## Table of Contents

1. [Introduction](#introduction)
2. [Architecture Overview](#architecture-overview)
3. [Key Components](#key-components)
   - [Stateless Passkey Wallet](#stateless-passkey-wallet)
   - [Hardware Wallet (NFC SatochipSigning
Device)](#hardware-wallet-nfc-satscard-signing-device)
   - [Stateless Server](#stateless-server)
4. [MuSig2 Protocol Integration](#musig2-protocol-integration)
5. [Wallet Configurations](#wallet-configurations)
   - [2-of-2 Configuration](#2-of-2-configuration)
   - [2-of-3 Configuration](#2-of-3-configuration)
6. [Decaying Multisig with CSV Timelocks](#decaying-multisig-with-csv-timelocks)
7. [Security Analysis](#security-analysis)
8. [Recovery Scenarios](#recovery-scenarios)
9. [Comparison with Existing Solutions](#comparison-with-existing-solutions)
10. [Implementation Considerations](#implementation-considerations)

---

## Introduction

Traditional Bitcoin wallets face a fundamental tension between
**security** and **usability**. Single-signature wallets are
vulnerable to key theft, while multisig wallets can lock users out of
their funds if keys are lost. Nuri Wallet resolves this tension
through an innovative combination of:

- **Stateless key derivation**: No persistent key storage means no
keys to steal from rest
- **MuSig2 aggregated signatures**: Multiple parties contribute to a
single Schnorr signature, maintaining privacy and reducing transaction
fees
- **Decaying timelocks**: Graduated recovery options that balance
security against lockout risk
- **Hardware wallet integration**: Optional cold storage for maximum security

---

## Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           NURI WALLET ARCHITECTURE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   PASSKEY KEY    â”‚  â”‚  HARDWARE KEY    â”‚  â”‚   SERVER KEY     â”‚          â”‚
â”‚  â”‚   (Stateless)    â”‚  â”‚  (NFC Satochip)  â”‚  â”‚   (Stateless)    â”‚          â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
â”‚  â”‚ WebAuthn PRF     â”‚  â”‚ Secure Element   â”‚  â”‚ HSM/Secure       â”‚          â”‚
â”‚  â”‚ Extension        â”‚  â”‚ on NFC Card      â”‚  â”‚ Element          â”‚          â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚          â”‚
â”‚  â”‚ key = PRF(salt)  â”‚  â”‚ Private key      â”‚  â”‚ key = f(user_id, â”‚          â”‚
â”‚  â”‚                  â”‚  â”‚ never leaves     â”‚  â”‚        entropy)  â”‚          â”‚
â”‚  â”‚ No key storage   â”‚  â”‚ the chip         â”‚  â”‚                  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚           â”‚                     â”‚                     â”‚                     â”‚
â”‚           â”‚    MuSig2 Partial   â”‚    MuSig2 Partial   â”‚                     â”‚
â”‚           â”‚    Signature        â”‚    Signature        â”‚                     â”‚
â”‚           â”‚                     â”‚                     â”‚                     â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                      â”‚                     â”‚                                â”‚
â”‚                      â–¼                     â–¼                                â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚           â”‚         MuSig2 SIGNATURE AGGREGATION    â”‚                       â”‚
â”‚           â”‚                                         â”‚                       â”‚
â”‚           â”‚  2-of-2: Passkey + Server               â”‚                       â”‚
â”‚           â”‚  2-of-3: Any 2 of {Passkey, HW, Server} â”‚                       â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    DECAYING TIMELOCK STRUCTURE                       â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚   T=0                    T=10,000 blocks              T=52,560       â”‚   â”‚
â”‚  â”‚    â”‚                          â”‚                       blocks         â”‚   â”‚
â”‚  â”‚    â–¼                          â–¼                          â–¼           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  NORMAL OPERATION  â”‚  RECOVERY MODE        â”‚  EMERGENCY EXIT â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  2-of-2 or 2-of-3  â”‚  Passkey + HW         â”‚  Passkey only   â”‚   â”‚
â”‚  â”‚  â”‚  (Server active)   â”‚  (Server unavailable) â”‚  (CSV expired)  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Key Components

### Stateless Passkey Wallet

The passkey-based key is the cornerstone of Nuri's user experience. It
leverages the **WebAuthn PRF (Pseudo-Random Function) extension** to
derive cryptographic keys without ever storing them.

#### How It Works

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PASSKEY KEY DERIVATION                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   User authenticates with passkey (biometric/PIN)               â”‚
â”‚                          â”‚                                      â”‚
â”‚                          â–¼                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚         WebAuthn Authenticator          â”‚                  â”‚
â”‚   â”‚    (Platform or Roaming Authenticator)  â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                          â”‚                                      â”‚
â”‚                          â–¼                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚           PRF Extension                 â”‚                  â”‚
â”‚   â”‚                                         â”‚                  â”‚
â”‚   â”‚   secret = HMAC-SHA256(device_secret,   â”‚                  â”‚
â”‚   â”‚                        salt || rpId)    â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                          â”‚                                      â”‚
â”‚                          â–¼                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚      Bitcoin Key Derivation             â”‚                  â”‚
â”‚   â”‚                                         â”‚                  â”‚
â”‚   â”‚   private_key = HKDF(secret,            â”‚                  â”‚
â”‚   â”‚                      "nuri-bitcoin",    â”‚                  â”‚
â”‚   â”‚                      derivation_path)   â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Security Properties

| Property | Description |
|----------|-------------|
| **Stateless** | No private keys stored on device; derived on-demand |
| **Phishing Resistant** | WebAuthn binds credentials to origin |
| **Hardware-Backed** | PRF secret stored in device secure element |
| **Biometric Protected** | User presence verified via fingerprint/face |

#### Key Derivation Formula

Given:
- $s$ = device master secret (in secure element)
- $\text{salt}$ = application-specific salt
- $\text{rpId}$ = relying party identifier

The PRF output is:

$$\text{prf\_output} = \text{HMAC-SHA256}(s, \text{salt} \| \text{rpId})$$

The Bitcoin private key is then derived as:

$$k_{\text{passkey}} = \text{HKDF-SHA256}(\text{prf\_output},
\text{"nuri-btc-v1"}, \text{path})$$

---

### Hardware Wallet (NFC Satochip Signing Device)

The hardware wallet component uses an **NFC-based secure element
card** (similar to Satochip or SatSigner) that performs **MuSig2
partial signing** without ever exposing its private key.

#### Capabilities

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  NFC HARDWARE WALLET                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚   â”‚   Secure Element    â”‚                                      â”‚
â”‚   â”‚   (JavaCard/etc)    â”‚                                      â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                      â”‚
â”‚   â”‚ â€¢ Private key       â”‚  â—„â”€â”€ Never leaves the chip           â”‚
â”‚   â”‚   generation        â”‚                                      â”‚
â”‚   â”‚ â€¢ MuSig2 nonce      â”‚                                      â”‚
â”‚   â”‚   generation        â”‚                                      â”‚
â”‚   â”‚ â€¢ Partial signature â”‚                                      â”‚
â”‚   â”‚   creation          â”‚                                      â”‚
â”‚   â”‚ â€¢ Public key export â”‚                                      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚            â–²                                                    â”‚
â”‚            â”‚ NFC                                                â”‚
â”‚            â–¼                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚   â”‚   Mobile Device     â”‚                                      â”‚
â”‚   â”‚   (Nuri App)        â”‚                                      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### MuSig2 Signing Flow

1. **Nonce Commitment Round**: Card generates random nonce
$R_{\text{hw}}$ and provides commitment
2. **Nonce Exchange**: All parties exchange nonce commitments, then
reveal nonces
3. **Partial Signing**: Card computes partial signature without
revealing private key
4. **Aggregation**: Partial signatures combined into final Schnorr signature

---

### Stateless Server

The server acts as a **2FA-protected co-signer** that adds entropy and
provides an additional security layer without introducing custody
risk.

#### Design Principles

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STATELESS SERVER                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚         Hardware Security Module        â”‚                  â”‚
â”‚   â”‚              (HSM)                       â”‚                  â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
â”‚   â”‚ â€¢ Master seed (never exported)          â”‚                  â”‚
â”‚   â”‚ â€¢ Deterministic key derivation          â”‚                  â”‚
â”‚   â”‚ â€¢ Rate limiting                         â”‚                  â”‚
â”‚   â”‚ â€¢ Audit logging                         â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                          â”‚                                      â”‚
â”‚                          â–¼                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚      Key Derivation Function            â”‚                  â”‚
â”‚   â”‚                                         â”‚                  â”‚
â”‚   â”‚   k_server = KDF(master_seed,           â”‚                  â”‚
â”‚   â”‚                  user_id,               â”‚                  â”‚
â”‚   â”‚                  wallet_id,             â”‚                  â”‚
â”‚   â”‚                  key_index)             â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â”‚   Properties:                                                   â”‚
â”‚   â€¢ No private keys stored in database                         â”‚
â”‚   â€¢ Keys derived on-demand from HSM                            â”‚
â”‚   â€¢ 2FA required before signing                                â”‚
â”‚   â€¢ Server breach doesn't compromise keys                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Server Key Derivation

The server derives user-specific keys deterministically:

$$k_{\text{server}} = \text{HKDF}(k_{\text{master}}, \text{user\_id}
\| \text{wallet\_id} \| \text{index})$$

Where $k_{\text{master}}$ is stored in the HSM and never exported.

---

## MuSig2 Protocol Integration

MuSig2 is a **multi-signature scheme** that produces a single
aggregated Schnorr signature indistinguishable from a regular
signature. This provides both **privacy** (observers can't tell it's
multisig) and **efficiency** (smaller transactions, lower fees).

### MuSig2 Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     MuSig2 PROTOCOL                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   SETUP PHASE (one-time)                                        â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                        â”‚
â”‚                                                                 â”‚
â”‚   Each party i has:                                             â”‚
â”‚   â€¢ Private key: xáµ¢                                             â”‚
â”‚   â€¢ Public key:  Páµ¢ = xáµ¢ Â· G                                    â”‚
â”‚                                                                 â”‚
â”‚   Aggregated public key:                                        â”‚
â”‚   P = Î£áµ¢ (aáµ¢ Â· Páµ¢)                                              â”‚
â”‚   where aáµ¢ = H(L, Páµ¢) and L = {Pâ‚, Pâ‚‚, ...}                     â”‚
â”‚                                                                 â”‚
â”‚   SIGNING PHASE (per transaction)                               â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                               â”‚
â”‚                                                                 â”‚
â”‚   Round 1: Nonce Generation                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚   â”‚ Party 1 â”‚  â”‚ Party 2 â”‚  â”‚ Party 3 â”‚                        â”‚
â”‚   â”‚ râ‚ â†’ Râ‚ â”‚  â”‚ râ‚‚ â†’ Râ‚‚ â”‚  â”‚ râ‚ƒ â†’ Râ‚ƒ â”‚                        â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                        â”‚
â”‚        â”‚            â”‚            â”‚                              â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                     â–¼                                           â”‚
â”‚              Exchange Ráµ¢ values                                 â”‚
â”‚                     â”‚                                           â”‚
â”‚                     â–¼                                           â”‚
â”‚   Round 2: Partial Signatures                                   â”‚
â”‚                                                                 â”‚
â”‚   R = Î£áµ¢ Ráµ¢  (aggregated nonce)                                 â”‚
â”‚   c = H(R, P, m)  (challenge)                                   â”‚
â”‚                                                                 â”‚
â”‚   Each party computes:                                          â”‚
â”‚   sáµ¢ = ráµ¢ + c Â· aáµ¢ Â· xáµ¢                                         â”‚
â”‚                                                                 â”‚
â”‚   Final signature:                                              â”‚
â”‚   s = Î£áµ¢ sáµ¢                                                     â”‚
â”‚   Ïƒ = (R, s)                                                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Why MuSig2 for Nuri?

| Benefit | Description |
|---------|-------------|
| **Privacy** | Aggregated signature looks like single-sig on-chain |
| **Efficiency** | One signature regardless of number of signers |
| **Taproot Native** | Designed for Bitcoin's Schnorr/Taproot upgrade |
| **Non-Interactive** | Only 2 rounds of communication needed |

---

## Wallet Configurations

### 2-of-2 Configuration

The basic configuration requires both the **passkey** and **server**
to sign transactions.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    2-of-2 CONFIGURATION                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   NORMAL OPERATION                                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚   â”‚  Passkey  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Server   â”‚                          â”‚
â”‚   â”‚   Key     â”‚  2FA    â”‚   Key     â”‚                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ verify  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚         â”‚                     â”‚                                 â”‚
â”‚         â”‚    MuSig2          â”‚                                 â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                    â–¼                                            â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚              â”‚ Combined â”‚                                       â”‚
â”‚              â”‚Signature â”‚                                       â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚                                                                 â”‚
â”‚   RECOVERY (Server Unavailable)                                 â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚
â”‚                                                                 â”‚
â”‚   After CSV timelock expires (~1 year):                         â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚   â”‚  Passkey  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Spend with single signature     â”‚
â”‚   â”‚   Key     â”‚                (CSV exit path)                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Transaction Structure (Taproot)

```
Output Script (P2TR):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OP_1 <aggregated_pubkey>                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Taproot Tree:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Internal Key                            â”‚
â”‚                    (MuSig2: Passkey + Server)                   â”‚
â”‚                              â”‚                                  â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚              â”‚                               â”‚                  â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚        â”‚  Leaf 1   â”‚                  â”‚   Leaf 2    â”‚           â”‚
â”‚        â”‚  (empty)  â”‚                  â”‚  CSV Exit   â”‚           â”‚
â”‚        â”‚           â”‚                  â”‚ <pk_passkey>â”‚           â”‚
â”‚        â”‚           â”‚                  â”‚ CHECKSIG    â”‚           â”‚
â”‚        â”‚           â”‚                  â”‚ <52560>     â”‚           â”‚
â”‚        â”‚           â”‚                  â”‚ CSV         â”‚           â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2-of-3 Configuration

The enhanced configuration adds a **hardware wallet** for additional
security and recovery options.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    2-of-3 CONFIGURATION                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   THREE SIGNING KEYS                                            â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚   â”‚  Passkey  â”‚    â”‚ Hardware  â”‚    â”‚  Server   â”‚              â”‚
â”‚   â”‚   (Hot)   â”‚    â”‚  Wallet   â”‚    â”‚  (2FA)    â”‚              â”‚
â”‚   â”‚           â”‚    â”‚  (Cold)   â”‚    â”‚           â”‚              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                â”‚                â”‚                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                  â”‚               â”‚                              â”‚
â”‚                  â–¼               â–¼                              â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚         â”‚   ANY 2-of-3 can sign        â”‚                        â”‚
â”‚         â”‚                              â”‚                        â”‚
â”‚         â”‚   â€¢ Passkey + Server (daily) â”‚                        â”‚
â”‚         â”‚   â€¢ Passkey + HW (recovery)  â”‚                        â”‚
â”‚         â”‚   â€¢ Server + HW (if needed)  â”‚                        â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                 â”‚
â”‚   SIGNING SCENARIOS                                             â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
â”‚                                                                 â”‚
â”‚   Scenario 1: Normal (Passkey + Server)                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  2FA  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚   â”‚ Passkey â”œâ”€â”€â”€â”€â”€â”€â–¶â”‚ Server  â”‚â”€â”€â”€â”€â–¶ âœ“ Transaction             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                 â”‚
â”‚   Scenario 2: Server Down (Passkey + Hardware)                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  NFC  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚   â”‚ Passkey â”œâ”€â”€â”€â”€â”€â”€â–¶â”‚   HW    â”‚â”€â”€â”€â”€â–¶ âœ“ Transaction             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      (No waiting!)             â”‚
â”‚                                                                 â”‚
â”‚   Scenario 3: Passkey Lost (Hardware + Server)                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚   â”‚   HW    â”œâ”€â”€â”€â”€â”€â”€â–¶â”‚ Server  â”‚â”€â”€â”€â”€â–¶ âœ“ Transaction             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Taproot Structure for 2-of-3

```
Taproot Tree (2-of-3):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Internal Key                            â”‚
â”‚              (MuSig2: Passkey + Server - default path)          â”‚
â”‚                              â”‚                                  â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚      â”‚                       â”‚                       â”‚          â”‚
â”‚ â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Leaf 1  â”‚           â”‚   Leaf 2    â”‚         â”‚   Leaf 3    â”‚   â”‚
â”‚ â”‚Passkey+ â”‚           â”‚ Passkey+    â”‚         â”‚  CSV Exit   â”‚   â”‚
â”‚ â”‚  HW     â”‚           â”‚  Server     â”‚         â”‚<pk_passkey> â”‚   â”‚
â”‚ â”‚(MuSig2) â”‚           â”‚ (redundant) â”‚         â”‚ CHECKSIG    â”‚   â”‚
â”‚ â”‚         â”‚           â”‚             â”‚         â”‚ <52560> CSV â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚ Note: Server+HW combination handled via Leaf 2 alternative      â”‚
â”‚       or additional leaf as needed                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Decaying Multisig with CSV Timelocks

The **decaying multisig** pattern ensures that users can always
recover their funds, with security guarantees that gracefully degrade
over time.

### How CSV (CheckSequenceVerify) Works

CSV enforces a **relative timelock** measured in blocks since the UTXO
was created:

$$\text{spendable\_height} = \text{confirmation\_height} + \text{csv\_blocks}$$

For Nuri Wallet:
- **Normal operation**: 2-of-2 or 2-of-3 MuSig2 required
- **After ~70 days** (10,000 blocks): Alternative recovery paths activate
- **After ~1 year** (52,560 blocks): Single-key emergency exit available

### Timelock Visualization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DECAYING SECURITY MODEL                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Security                                                       â”‚
â”‚  Level                                                          â”‚
â”‚    â–²                                                            â”‚
â”‚    â”‚                                                            â”‚
â”‚  3 â”¤ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”                                      â”‚
â”‚    â”‚                     â”‚                                      â”‚
â”‚  2 â”¤                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   2-of-3 config  â”‚
â”‚    â”‚                                         â”‚   (HW available) â”‚
â”‚    â”‚                                         â”‚                  â”‚
â”‚  1 â”¤                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚    â”‚                                                            â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶       â”‚
â”‚         T=0            T=10,000         T=52,560      Time      â”‚
â”‚         â”‚              blocks           blocks        (blocks)  â”‚
â”‚         â”‚              (~70 days)       (~1 year)               â”‚
â”‚         â”‚                 â”‚                â”‚                    â”‚
â”‚         â–¼                 â–¼                â–¼                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚ Maximum  â”‚     â”‚ HW Recovery  â”‚  â”‚  Emergency   â”‚          â”‚
â”‚   â”‚ Security â”‚     â”‚  Available   â”‚  â”‚    Exit      â”‚          â”‚
â”‚   â”‚  2FA +   â”‚     â”‚ No server    â”‚  â”‚  Passkey     â”‚          â”‚
â”‚   â”‚ Passkey  â”‚     â”‚   needed     â”‚  â”‚    only      â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Script Structure

**CSV Exit Script (simplified):**

```
OP_IF
    // Normal spending path: requires aggregated MuSig2 signature
    <aggregated_pubkey>
    OP_CHECKSIG
OP_ELSE
    // Emergency exit: after timelock, passkey alone can spend
    <52560>           // ~1 year in blocks
    OP_CHECKSEQUENCEVERIFY
    OP_DROP
    <passkey_pubkey>
    OP_CHECKSIG
OP_ENDIF
```

### Re-locking Mechanism

To maintain maximum security, users should periodically "refresh" their UTXOs:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UTXO REFRESH CYCLE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Initial Deposit          After 11 months         Re-deposit  â”‚
â”‚        â”‚                        â”‚                       â”‚       â”‚
â”‚        â–¼                        â–¼                       â–¼       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚  UTXO   â”‚   Time       â”‚  UTXO   â”‚   Self-    â”‚  UTXO   â”‚ â”‚
â”‚   â”‚  CSV=0  â”‚  â”€â”€â”€â”€â”€â–¶      â”‚CSV=47520â”‚   send     â”‚  CSV=0  â”‚ â”‚
â”‚   â”‚         â”‚              â”‚ (aging) â”‚  â”€â”€â”€â”€â”€â–¶    â”‚ (fresh) â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚   Security: MAX            Security: Degrading    Security: MAXâ”‚
â”‚                                                                 â”‚
â”‚   Wallet prompts user when UTXOs approach timelock expiry      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security Analysis

### Threat Model

| Threat | Mitigation |
|--------|------------|
| **Device theft** | Passkey protected by biometrics; key derived on-demand |
| **Server compromise** | Server keys in HSM; stateless derivation;
server alone cannot spend |
| **Phishing** | WebAuthn origin binding prevents credential theft |
| **Man-in-the-middle** | MuSig2 nonce protocol prevents signature forgery |
| **Server disappearance** | CSV timelock enables recovery; HW wallet
provides immediate alternative |
| **Hardware wallet loss** | 2-of-3 allows recovery with passkey + server |
| **Passkey loss** | 2-of-3 allows recovery with HW + server |

### Security Levels by Configuration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                SECURITY COMPARISON                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                    2-of-2           2-of-3                      â”‚
â”‚                    â”€â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€â”€                      â”‚
â”‚                                                                 â”‚
â”‚   Keys Required      2                2                         â”‚
â”‚   to Spend                                                      â”‚
â”‚                                                                 â”‚
â”‚   Single Point       Passkey         None                       â”‚
â”‚   of Failure         (for CSV exit)  (any 2 keys work)          â”‚
â”‚                                                                 â”‚
â”‚   Server Down        Wait ~1 year    Use Passkey + HW           â”‚
â”‚   Recovery                           (immediate)                â”‚
â”‚                                                                 â”‚
â”‚   Passkey Lost       Funds locked    Use Server + HW            â”‚
â”‚   Recovery           (CSV doesn't    (immediate)                â”‚
â”‚                      help here!)                                â”‚
â”‚                                                                 â”‚
â”‚   Best For           Simplicity,     Maximum security,          â”‚
â”‚                      casual users    significant holdings       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Attack Scenarios

#### Scenario 1: Attacker Compromises Server

```
Attacker obtains: Server signing capability
Attacker needs:   Passkey authentication OR Hardware wallet

Result: âŒ Cannot steal funds (missing second key)
        âš ï¸  Can potentially DoS by refusing to sign
        âœ… User recovers via CSV exit or HW wallet
```

#### Scenario 2: Attacker Steals Phone

```
Attacker obtains: Physical device
Attacker needs:   Biometric/PIN to unlock passkey
                  PLUS 2FA to authorize server signing

Result: âŒ Cannot steal funds (passkey protected by biometrics)
        âœ… Keys never stored on device (stateless)
```

#### Scenario 3: Attacker Compromises Both Passkey AND Server

```
Attacker obtains: Passkey credential + Server access
Result: âš ï¸  Can steal funds in 2-of-2 config
        âœ… 2-of-3 config: HW wallet still required
```

---

## Recovery Scenarios

### Complete Recovery Matrix

| Scenario | 2-of-2 Config | 2-of-3 Config |
|----------|---------------|---------------|
| **Lost phone (passkey)** | Wait for CSV (~1 year), then... âŒ still
can't spend! | Server + HW âœ… |
| **Server goes offline** | Wait for CSV (~1 year) âœ… | Passkey + HW âœ…
(immediate) |
| **Lost hardware wallet** | N/A (not in config) | Passkey + Server âœ… |
| **Lost phone + server down** | âŒ Funds lost | HW can spend after
CSV? (design decision) |
| **Lost HW + server down** | Wait for CSV âœ… | Wait for CSV âœ… |

### Recovery Flow: Server Unavailable (2-of-3)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          RECOVERY: SERVER UNAVAILABLE (2-of-3)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Step 1: Detect server unavailability                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚ App: "Server unreachable. Use hardware  â”‚                  â”‚
â”‚   â”‚       wallet for recovery signing?"     â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â”‚   Step 2: Authenticate with passkey                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚ User: [Biometric authentication]        â”‚                  â”‚
â”‚   â”‚ App:  Derives passkey private key       â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â”‚   Step 3: Tap NFC hardware wallet                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚ App: "Tap your Nuri Card to sign"       â”‚                  â”‚
â”‚   â”‚                                         â”‚                  â”‚
â”‚   â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚                  â”‚
â”‚   â”‚        â”‚  ğŸ“± â†â†’ ğŸ’³ â”‚  NFC               â”‚                  â”‚
â”‚   â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â”‚   Step 4: MuSig2 signing between Passkey + HW                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚ Passkey partial sig + HW partial sig    â”‚                  â”‚
â”‚   â”‚              â†“                          â”‚                  â”‚
â”‚   â”‚    Aggregated Schnorr signature         â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â”‚   Step 5: Broadcast transaction                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚ Transaction broadcast to Bitcoin networkâ”‚                  â”‚
â”‚   â”‚ âœ… Funds recovered without server       â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Recovery Flow: CSV Emergency Exit (2-of-2)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RECOVERY: CSV EMERGENCY EXIT                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Prerequisites:                                                â”‚
â”‚   â€¢ Server has been unavailable for extended period             â”‚
â”‚   â€¢ UTXO age > 52,560 blocks (~1 year)                          â”‚
â”‚   â€¢ User still has passkey access                               â”‚
â”‚                                                                 â”‚
â”‚   Step 1: Check UTXO eligibility                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚ App scans UTXOs for CSV-eligible funds  â”‚                  â”‚
â”‚   â”‚                                         â”‚                  â”‚
â”‚   â”‚ UTXO 1: 0.5 BTC  - Age: 55,000 blocks âœ…â”‚                  â”‚
â”‚   â”‚ UTXO 2: 0.3 BTC  - Age: 40,000 blocks âŒâ”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â”‚   Step 2: Construct CSV spending transaction                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚ Input: UTXO with nSequence = 52,560     â”‚                  â”‚
â”‚   â”‚ Witness: <passkey_signature> <csv_script>â”‚                  â”‚
â”‚   â”‚ Output: New address controlled by user  â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â”‚   Step 3: Sign with passkey only                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚ No server needed - single signature     â”‚                  â”‚
â”‚   â”‚ sufficient for CSV exit path            â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â”‚   Step 4: Broadcast and confirm                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚ Transaction valid because:              â”‚                  â”‚
â”‚   â”‚ â€¢ CSV timelock satisfied                â”‚                  â”‚
â”‚   â”‚ â€¢ Valid passkey signature provided      â”‚                  â”‚
â”‚   â”‚ âœ… Funds recovered!                     â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Comparison with Existing Solutions

### Nuri vs. Blockstream Green

| Feature | Blockstream Green | Nuri Wallet |
|---------|-------------------|-------------|
| **Signature Scheme** | ECDSA multisig | MuSig2 Schnorr |
| **On-chain Footprint** | Visible multisig | Single-sig appearance |
| **Client Key Storage** | Encrypted on device | Stateless (PRF-derived) |
| **Server Key Storage** | Traditional HSM | Stateless HSM derivation |
| **Recovery (2-of-2)** | CSV timelock | CSV timelock |
| **Recovery (2-of-3)** | Backup key phrase | Hardware wallet |
| **Taproot Support** | Limited | Native |

### Nuri vs. Traditional Hardware Wallets

| Feature | Ledger/Trezor | Nuri Wallet |
|---------|---------------|-------------|
| **Form Factor** | Dedicated device | Passkey + NFC card |
| **Daily Transactions** | Device required | Passkey only (server 2FA) |
| **High-Value Transactions** | Same as daily | Can require HW card |
| **Loss Recovery** | Seed phrase | Multiple paths (CSV, 2-of-3) |
| **Theft Risk** | Seed phrase exposure | No seed phrase needed |

### Nuri vs. Custodial Solutions

| Feature | Custodial Exchange | Nuri Wallet |
|---------|-------------------|-------------|
| **Key Control** | Exchange holds keys | User holds all keys |
| **Counterparty Risk** | High | None |
| **Regulatory Risk** | Subject to seizure | Self-sovereign |
| **Recovery** | Account recovery | CSV + multisig |
| **Privacy** | KYC required | No KYC for self-custody |

---

## Implementation Considerations

### WebAuthn PRF Browser Support

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 WEBAUTHN PRF SUPPORT STATUS                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Browser/Platform          PRF Support    Notes                â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€                â”‚
â”‚   Chrome (Desktop)          âœ… Yes         Windows Hello, etc.  â”‚
â”‚   Chrome (Android)          âœ… Yes         Fingerprint/PIN      â”‚
â”‚   Safari (macOS)            âœ… Yes         Touch ID             â”‚
â”‚   Safari (iOS)              âœ… Yes         Face ID/Touch ID     â”‚
â”‚   Firefox                   âš ï¸ Partial     Platform dependent   â”‚
â”‚   Security Keys             âš ï¸ Varies      FIDO2 Level 2 req.   â”‚
â”‚                                                                 â”‚
â”‚   Fallback Strategy:                                            â”‚
â”‚   â€¢ Detect PRF support at registration                          â”‚
â”‚   â€¢ Fall back to encrypted key storage if unavailable           â”‚
â”‚   â€¢ Clearly communicate security implications to user           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### MuSig2 Implementation Notes

**Key Aggregation:**

```typescript
// Simplified MuSig2 key aggregation
function aggregateKeys(pubkeys: Uint8Array[]): Uint8Array {
  // Sort pubkeys lexicographically for determinism
  const sortedKeys = [...pubkeys].sort(compareBytes);

  // Compute key aggregation coefficients
  const L = hashKeys(sortedKeys);

  // Aggregate with coefficients
  let aggregated = Point.ZERO;
  for (const pk of sortedKeys) {
    const P = Point.fromBytes(pk);
    const a = computeCoefficient(L, pk);
    aggregated = aggregated.add(P.multiply(a));
  }

  return aggregated.toBytes();
}
```

**Nonce Generation (Critical for Security):**

```typescript
// MuSig2 requires fresh, unpredictable nonces
function generateNonce(
  secretKey: Uint8Array,
  publicKey: Uint8Array,
  message: Uint8Array,
  extraRand: Uint8Array
): { secretNonce: Uint8Array; publicNonce: Uint8Array } {
  // MUST use fresh randomness for each signing session
  const rand = crypto.getRandomValues(new Uint8Array(32));

  // Derive nonce deterministically from inputs + randomness
  const k = taggedHash(
    "MuSig2/nonce",
    concat(secretKey, publicKey, message, rand, extraRand)
  );

  return {
    secretNonce: k,
    publicNonce: Point.BASE.multiply(k).toBytes()
  };
}
```

### NFC Hardware Wallet Protocol

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              NFC SIGNING PROTOCOL (APDU)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Command                    Response                           â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€                           â”‚
â”‚                                                                 â”‚
â”‚   SELECT APPLET              OK + Version                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”‚ CLA: 00        â”‚   â”€â”€â–¶   â”‚ SW: 9000       â”‚                â”‚
â”‚   â”‚ INS: A4        â”‚         â”‚ Version: 1.0   â”‚                â”‚
â”‚   â”‚ AID: Nuri...   â”‚         â”‚                â”‚                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                 â”‚
â”‚   GET PUBLIC KEY             Public Key                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”‚ CLA: E0        â”‚   â”€â”€â–¶   â”‚ SW: 9000       â”‚                â”‚
â”‚   â”‚ INS: 40        â”‚         â”‚ PubKey: 33B    â”‚                â”‚
â”‚   â”‚ Path: m/86'/...â”‚         â”‚                â”‚                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                 â”‚
â”‚   MUSIG2 NONCE               Nonce Commitment                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”‚ CLA: E0        â”‚   â”€â”€â–¶   â”‚ SW: 9000       â”‚                â”‚
â”‚   â”‚ INS: 50        â”‚         â”‚ R: 33B         â”‚                â”‚
â”‚   â”‚ SessionID      â”‚         â”‚                â”‚                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                 â”‚
â”‚   MUSIG2 SIGN                Partial Signature                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”‚ CLA: E0        â”‚   â”€â”€â–¶   â”‚ SW: 9000       â”‚                â”‚
â”‚   â”‚ INS: 52        â”‚         â”‚ s: 32B         â”‚                â”‚
â”‚   â”‚ Message hash   â”‚         â”‚                â”‚                â”‚
â”‚   â”‚ Agg nonce      â”‚         â”‚                â”‚                â”‚
â”‚   â”‚ Agg pubkey     â”‚         â”‚                â”‚                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Conclusion

Nuri Wallet represents a significant advancement in Bitcoin
self-custody, combining:

1. **Stateless Security**: No persistent key storage reduces attack surface
2. **Multi-Party Signing**: MuSig2 provides privacy and efficiency
3. **Graceful Degradation**: Decaying timelocks ensure recovery is
always possible
4. **Flexible Security**: 2-of-2 and 2-of-3 configurations for different needs

The architecture ensures that users maintain full sovereignty over
their Bitcoin while benefiting from the security of multi-signature
protection and the convenience of modern authentication methods.

---

## Appendix A: Glossary

| Term | Definition |
|------|------------|
| **CSV** | CheckSequenceVerify; Bitcoin opcode for relative timelocks |
| **HSM** | Hardware Security Module; tamper-resistant key storage |
| **MuSig2** | Multi-signature scheme for Schnorr signatures |
| **PRF** | Pseudo-Random Function; WebAuthn extension for key derivation |
| **Taproot** | Bitcoin upgrade enabling Schnorr signatures and MAST |
| **UTXO** | Unspent Transaction Output; Bitcoin's accounting model |
| **WebAuthn** | Web Authentication standard for passwordless auth |

---

## Appendix B: References

1. [BIP-340: Schnorr Signatures for
secp256k1](https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki)
2. [BIP-341: Taproot](https://github.com/bitcoin/bips/blob/master/bip-0341.mediawiki)
3. [BIP-327: MuSig2](https://github.com/bitcoin/bips/blob/master/bip-0327.mediawiki)
4. [WebAuthn PRF Extension](https://w3c.github.io/webauthn/#prf-extension)
5. [Blockstream Green Security
Model](https://help.blockstream.com/hc/en-us/articles/900001391763)

---
*Post created via email from emin@nuri.com*
